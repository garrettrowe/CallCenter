[{"id":"45bfaeea.5a7458","type":"tab","label":"SIP Flow","disabled":false,"info":""},{"id":"8246e271.253b4","type":"tab","label":"Page Rendering","disabled":false,"info":""},{"id":"8947e16a.c645f8","type":"websocket-listener","z":"","path":"/ws/listener","wholemsg":"true"},{"id":"759a025.71509fc","type":"dashDB","z":"","hostname":"dashdb-entry-yp-dal10-01.services.dal.bluemix.net","db":"BLUDB","port":"50000","name":"DB2"},{"id":"43d08a57.f16084","type":"wml-config","z":"","host":"https://ibm-watson-ml.mybluemix.net","accesskey":"1","instanceid":"5302c7dc-ff05-4ff2-be2a-1b2f67e8ca76","name":""},{"id":"82e8c1b2.88f33","type":"websocket-listener","z":"","path":"/ws/discovery","wholemsg":"false"},{"id":"5fa6141c.886c84","type":"http response","z":"45bfaeea.5a7458","name":"","statusCode":"","headers":{},"x":1210,"y":380,"wires":[]},{"id":"1f6dbee.a0ad441","type":"websocket out","z":"45bfaeea.5a7458","name":"ws","server":"8947e16a.c645f8","client":"","x":1150,"y":220,"wires":[]},{"id":"9370be58.996e1","type":"function","z":"45bfaeea.5a7458","name":"","func":"msg2 = {};\nmsg2.chat = msg.chat;\nmsg2.user = msg.user;\n\n// node.warn('msg2.chat: ' + msg2.chat)\n\nreturn msg2;","outputs":1,"noerr":0,"x":1030,"y":220,"wires":[["1f6dbee.a0ad441"]]},{"id":"99381abc.06e15","type":"http in","z":"45bfaeea.5a7458","name":"","url":"/sip","method":"post","upload":false,"swaggerDoc":"","x":100,"y":180,"wires":[["3108343f.5fc9d4"]]},{"id":"3108343f.5fc9d4","type":"function","z":"45bfaeea.5a7458","name":"SIP Input","func":"var ucontext = flow.get('ucontext');\nvar agents = flow.get('agents');\nmsg.origin = \"sip\";\n\nif (typeof(ucontext) == \"undefined\"){\n    ucontext = [];\n}\nmsg.user = msg.payload.context.vgwSIPFromURI.match(/\\d*(?=@)/)[0];\n\n\nif (typeof(agents[msg.user]) == \"undefined\"){\n    agents[msg.user] = null;\n}\n\nmsg.agentCall = agents[msg.user];\n\nif (typeof(ucontext[msg.user]) == \"undefined\"){\n    ucontext[msg.user] = {};\n}\nmsg.params = {};\nmsg.params.context = ucontext[msg.user];\nmsg.params.context.agent = false;\nmsg.params.context.vgwPostResponseTimeoutCount = 20000;\n\nmsg.payload = msg.payload.input.text;\n\nflow.set('ucontext', ucontext);\nflow.set('agents', agents);\n\nif (msg.payload == \"vgwHangUp\")\n    return [msg,null];\nif (msg.payload == \"vgwPostResponseTimeout\")\n    return [msg,null];\nif (msg.payload === \"\")\n    return [msg,null];\n\nif (agents[msg.user] !== null)\n    return [msg,msg]; //agent on\n\n\nreturn [null, msg]; //no agent\n\n","outputs":2,"noerr":0,"x":240,"y":180,"wires":[["7c6826e9.1b1d6"],["45196eaf.44bbf8"]]},{"id":"c402f685.779ff8","type":"function","z":"45bfaeea.5a7458","name":"Assemble","func":"var ucontext = flow.get('ucontext');\nucontext[msg.user].context = msg.payload.context;\nflow.set('ucontext',ucontext);\n\n// node.warn('payload.output.text: ' + msg.payload.output.text);\n\n// var text = msg.payload.output.text.join(' ');\n// text = text.replace(/<[^>]*>/g, \" \");\nvar text = '';\nfor(var item of msg.payload.output.text) {\n    text = text + item + '<br/>';\n}\n\n\n\n// node.warn('var text: ' + text);\n\nmsg.payload.text = text;\nmsg.payload.link = msg.link\nmsg.time= (new Date()).toTimeString().slice(0,5);\n\n// node.warn('got intent: ' + msg.payload.intents[0].intent)\n\n\nvar t = {};\nt.user = msg.user;\nt.payload = text;\n\nreturn [msg,t];\n","outputs":2,"noerr":0,"x":880,"y":320,"wires":[["9a0b36d1.fc3148"],["c0cbc967.05a908"]]},{"id":"7eee4143.cf842","type":"websocket in","z":"45bfaeea.5a7458","name":"","server":"8947e16a.c645f8","client":"","x":120,"y":300,"wires":[["78222dec.7fe19c"]]},{"id":"78222dec.7fe19c","type":"function","z":"45bfaeea.5a7458","name":"Input","func":"var ucontext = flow.get('ucontext');\nvar workspaces = flow.get('assistants');\nmsg.origin = \"chat\";\n\nif (typeof msg.context !== 'undefined'){\n    msg.params = {}\n    msg.params.context = msg.context;\n}\n\nif (typeof(ucontext[msg.user]) == \"undefined\"){\n    ucontext[msg.user] = {};\n}\n\nucontext[msg.user].industry = msg.industry;\n\nmsg.params = {}\nmsg.params.workspace_id = workspaces[ucontext[msg.user].industry]\n\nmsg.payload = msg.text === \"\" ? \"hello\" : msg.text;\n\nflow.set('ucontext',ucontext);\n\nreturn msg;\n","outputs":1,"noerr":0,"x":290,"y":300,"wires":[["23fdc12d.eb019e","1ba6aa7f.0c67c6","8899dcc9.ab69f"]]},{"id":"b9afe0d5.5a295","type":"function","z":"45bfaeea.5a7458","name":"Assemble","func":"var text = msg.payload.output.text.join('<speak version=\"1.0\"><break strength=\"strong\"></break></speak>');\n\nmsg.payload.output.text = [text];\n\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1080,"y":380,"wires":[["5fa6141c.886c84"]]},{"id":"9a0b36d1.fc3148","type":"template","z":"45bfaeea.5a7458","name":"Watson","field":"chat","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<li class=\"left clearfix\">\n    <span class=\"chat-img pull-left\">\n        <img src=\"http://placehold.it/50/55C1E7/fff&text=W\" alt=\"Watson\" class=\"img-circle\" />\n    </span>\n            <div class=\"chat-body clearfix\">\n                <div class=\"header\">\n                    <strong class=\"primary-font\">Watson</strong> <small class=\"pull-right text-muted\">\n                    \n                </div>\n                <p>{{{payload.text}}}</p>\n                <p>{{{! payload.link}}}</p>\n            </div>\n</li>","output":"str","x":880,"y":260,"wires":[["9370be58.996e1"]]},{"id":"23fdc12d.eb019e","type":"template","z":"45bfaeea.5a7458","name":"User","field":"chat","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<li class=\"right clearfix\">\n    <span class=\"chat-img pull-right\">\n        <img src=\"http://placehold.it/50/FA6F57/fff&text=U\" alt=\"User Avatar\" class=\"img-circle\" />\n    </span>\n            <div class=\"chat-body clearfix\">\n                <div class=\"header\">\n                    <strong class=\"primary-font\">You</strong>\n                </div>\n                <p>{{payload}}</p>\n            </div>\n</li>","output":"str","x":870,"y":220,"wires":[["9370be58.996e1"]]},{"id":"321402cc.35178e","type":"function","z":"45bfaeea.5a7458","name":"","func":"var ucontext = flow.get('ucontext');\nvar workspaces = flow.get('assistants');\nmsg.params = {}\nmsg.ucontext = ucontext;\nmsg.params.workspace_id = workspaces[ucontext[msg.user].industry]\n\n\nmsg.params.context = ucontext[msg.user].context;\n\n\nmsg.payload = msg.payload === \"\" ? \"hello\" : msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":360,"wires":[["1ba6aa7f.0c67c6"]]},{"id":"e8c3fcbd.4b774","type":"http request","z":"45bfaeea.5a7458","name":"Call Agent","method":"GET","ret":"txt","url":"","tls":"","x":850,"y":440,"wires":[[]]},{"id":"1e63c884.a708d7","type":"http in","z":"45bfaeea.5a7458","name":"","url":"/agentCallback","method":"post","upload":false,"swaggerDoc":"","x":140,"y":140,"wires":[["14170444.e66784"]]},{"id":"14170444.e66784","type":"function","z":"45bfaeea.5a7458","name":"","func":"agents = flow.get(\"agents\");\nmsg.user = msg.req.query.from;\n\nif (msg.payload.CallStatus == \"in-progress\"){\n    agents[msg.user] = msg.payload.CallSid;\n    flow.set(\"agents\", agents);\n    msg.payload = \"An Agent has joined your call\";\n    return [msg, msg];\n}\nelse{\n    agents[msg.user] = null;\n    flow.set(\"agents\", agents);\n    return [null, msg];\n}\n","outputs":2,"noerr":0,"x":370,"y":140,"wires":[["f6f63353.35e8c8"],["a447f7e5.b36af"]]},{"id":"b98e5fba.e5eea8","type":"start-up-trigger","z":"45bfaeea.5a7458","x":180,"y":1040,"wires":[["c7586a2.db73598"]]},{"id":"c7586a2.db73598","type":"change","z":"45bfaeea.5a7458","name":"","rules":[{"t":"set","p":"agents","pt":"flow","to":"{}","tot":"json"},{"t":"set","p":"speaker","pt":"flow","to":"{}","tot":"json"},{"t":"set","p":"assistants","pt":"flow","to":"{\"0\":\"45805ac3-40b8-4455-afbb-5fb65d7cc3fc\",\"1\":\"18a3d8c4-d8a1-48b5-8231-a27f611c4ac0\"}","tot":"json"},{"t":"set","p":"ucontext","pt":"flow","to":"{}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":1040,"wires":[[]]},{"id":"70e4e4b5.46beb4","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Search Assistant Demo</title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" >\n    \n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\" ></script>  \n    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>\n\n    <style>\n        html, body{\n            height: 99% !important;\n            overflow:hidden !important;\n        }\n        #chatbar{\n            display:{{hideChat}};\n        }\n        .cont1{\n            width: 100% !important;\n            height: 100% !important;\n            overflow: hidden !important;\n        }\n\n        .cont2{\n            width: 100% !important;\n            height: 99% !important;\n            overflow: auto !important;\n            padding-right: 15px !important;\n        }\n        .panel-header{\n            background-color:white;\n    padding: 10px 10px 10px 10px;\n        }\n        .chat\n        {\n            list-style: none;\n            margin: 0;\n            padding: 0;\n        }\n        \n        .chat li\n        {\n            margin-bottom: 10px;\n            padding-bottom: 5px;\n            border-bottom: 1px dotted #B3A9A9;\n        }\n        \n        .chat li.left .chat-body\n        {\n            margin-left: 60px;\n        }\n        \n        .chat li.right .chat-body\n        {\n            margin-right: 60px;\n        }\n        \n        \n        .chat li .chat-body p\n        {\n            margin: 0;\n            color: #777777;\n        }\n        \n        .panel .slidedown .glyphicon, .chat .glyphicon\n        {\n            margin-right: 5px;\n        }\n        .container{\n            margin:0px 0px 0px 0px;\n        }\n        .panel-body {\n            padding: 0px;\n        }\n        \n        \n        \n\n    </style>\n  </head>\n  <body>\n      \n<div class=\"container\" style=\"height:100vh\">\n    <div class=\"row\" style=\"height:100vh\">\n        <div class=\"col-md-5\" style=\"height:100vh\">\n                <div id=\"chatbar\" class=\"panel-header\">\n                    <div class=\"input-group\">\n                        <input id=\"btn-input\" type=\"text\" class=\"form-control input-sm\" placeholder=\"Type your message here...\" />\n                        <span class=\"input-group-btn\">\n                            <button class=\"btn btn-info btn-sm\" id=\"btn-chat\">\n                                Send</button>\n                        </span>\n                    </div>\n                </div>\n                <div class=\"panel-body\" style=\"height:90vh;\">\n                    <div class=\"cont1\"><div class=\"cont2\">\n                        <ul class=\"chat\" id=\"chat\">\n                     \n                        </ul>\n                    </div></div>\n                </div>\n        </div>\n    </div>\n</div>\n\n      \n      \n                        \n  </body>\n  <script src=\"/js\"></script>\n</html>","output":"str","x":440,"y":120,"wires":[["d1003420.4bca3"]]},{"id":"d1003420.4bca3","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"text/html","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":120,"wires":[["f85e1fc8.dab9e"]]},{"id":"597ab33.bb4304c","type":"http in","z":"8246e271.253b4","name":"","url":"/demo","method":"get","upload":false,"swaggerDoc":"","x":170,"y":120,"wires":[["6143e68d.f84668"]]},{"id":"22b6d48c.b0a8fc","type":"http in","z":"8246e271.253b4","name":"","url":"/js","method":"get","upload":false,"swaggerDoc":"","x":150,"y":160,"wires":[["4d9abed6.17bc8"]]},{"id":"450614e4.fc6eb4","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/javascript","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":160,"wires":[["f85e1fc8.dab9e"]]},{"id":"4d9abed6.17bc8","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"javascript","syntax":"plain","template":"var getUrlParameter = function getUrlParameter(sParam) {\n    var sPageURL = decodeURIComponent(window.location.search.substring(1)),\n        sURLVariables = sPageURL.split('&'),\n        sParameterName,\n        i;\n\n    for (i = 0; i < sURLVariables.length; i++) {\n        sParameterName = sURLVariables[i].split('=');\n\n        if (sParameterName[0] === sParam) {\n            return sParameterName[1] === undefined ? true : sParameterName[1];\n        }\n    }\n};\n\nvar socket;\n\nattempts = 0\n\n\nyourPhone = getUrlParameter('yourPhone');\nagentPhone = getUrlParameter('agentPhone');\nindustry = getUrlParameter('industry');\n\n$(\"#btn-chat\").click(function(){\n    var msg = {\n        text: $(\"#btn-input\").val(),\n        user:   yourPhone,\n        industry: industry\n      };\n\tsocket.send(JSON.stringify(msg));\n});\n\n\nfunction updateChat(update){\n    watsonTextArea.value += update;\n    watsonTextArea.scrollTop = watsonTextArea.scrollHeight;\n}\nfunction connect(){\n    var host = \"wss://customerconcierge.mybluemix.net/ws/listener\";\n    try{\n        socket = new WebSocket(host);\n        socket.onopen = function(){console.log(\"socket connected\");}\n        socket.onmessage = function(msg){\n            var json = JSON.parse(msg.data);\n            if(json.user == yourPhone){\n                $(\"#chat\").prepend(json.chat);\n            }\n        }\n        socket.onclose = function () {\n            console.log(\"socket closed\");\n            var time = generateInterval(attempts);\n            setTimeout(function () {\n                attempts++;\n                connect(); \n            }, time);\n        }\n    } catch(exception){console.log('Socket Error: '+exception);}\n    function send(){\n        var text = \"\";\n        try{\n            socket.send(text);\n        } catch(exception){console.log('Socket Error: '+exception);}\n    }\n    function generateInterval (k) {\n        var maxInterval = (Math.pow(2, k) - 1) * 1000;\n        if (maxInterval > 30*1000) {\n            maxInterval = 30*1000; \n        }\n        return Math.random() * maxInterval; \n    }\n}\nif(!(\"WebSocket\" in window)){}\nelse{\n    connect();\n}\n\n","x":320,"y":160,"wires":[["450614e4.fc6eb4"]]},{"id":"f85e1fc8.dab9e","type":"http response","z":"8246e271.253b4","name":"","statusCode":"","headers":{},"x":890,"y":140,"wires":[]},{"id":"522f4973.37853","type":"function","z":"45bfaeea.5a7458","name":"","func":"var agents = flow.get('agents');\nif (typeof(agents[msg.user]) == \"undefined\"){\n    agents[msg.user] = null;\n}\n\n\nif (agents[msg.user] === null){\n    if (msg.payload.context.agent){\n        node.warn('sending to an agent');\n        msg.url = \"https://conciergevoiceserver.mybluemix.net/callAgent?from=\" + msg.user\n        msg.payload.context.agent = false;\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":690,"y":440,"wires":[["e8c3fcbd.4b774"]]},{"id":"f67ff127.25956","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Search Assistant Demo</title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" >\n    \n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\">\n    <link rel=\"stylesheet\" href=\"https://darktribes.mybluemix.net/stylesheets/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\" ></script>  \n    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>\n    \n    <style>\n      .btn-default{ text-align: center; }\n    input[type=\"checkbox\"]{\n        margin-right:8px;\n    }\n\n    p{\n        margin: 0 0 2px;\n        clear:both;\n    }\n    \n    p.size{\n        font-size: 14px;\n    }\n        .cont1{\n            width: 100% !important;\n            height: 100% !important;\n            overflow: hidden !important;\n        }\n\n        .cont2{\n            width: 100% !important;\n            height: 100% !important;\n            overflow: auto !important;\n            padding-right: 15px !important;\n        }\n        \n        .chat\n        {\n            list-style: none;\n            margin: 0;\n            padding: 0;\n        }\n        \n        .chat li\n        {\n            margin-bottom: 10px;\n            padding-bottom: 5px;\n            border-bottom: 1px dotted #B3A9A9;\n        }\n        \n        .chat li.left .chat-body\n        {\n            margin-left: 60px;\n        }\n        \n        .chat li.right .chat-body\n        {\n            margin-right: 60px;\n        }\n        \n        \n        .chat li .chat-body p\n        {\n            margin: 0;\n            color: #777777;\n        }\n        \n        .panel .slidedown .glyphicon, .chat .glyphicon\n        {\n            margin-right: 5px;\n        }\n        .jumbotron{\n            margin-top:40px;\n        }\n    </style>\n  </head>\n  <body>\n<nav class=\"navbar navbar-inverse navbar-fixed-top\">\n      <div class=\"container\">\n        <div class=\"navbar-header\">\n            <ul class=\"nav navbar-nav hidden-xs\">\n            <li class=\"dropdown\">\n                <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" role=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                    <div class=\"micon\"></div><div class=\"micon\"></div><div class=\"micon\"></div>\n                </a>\n                <ul class=\"dropdown-menu\">\n                    <li><a href='https://ibm.biz/darkTribes'>Illuminating Dark Tribes with Watson</a></li><li><a href='http://ibm.biz/vegetationManagement'>Cognitive Vegetation Optimization</a></li><li><a href='http://ibm.biz/chatClassification'>Cognitive Chat Demo</a></li><li><a href='http://commscalendarapi.mybluemix.net/news/'>Cognitive News Demo</a></li><li role=\"separator\" class=\"divider\"></li><li><a href=\"http://ibm.biz/commsdemos\">Demo Blog</a></li>\n                </ul>\n            </li>\n            </ul>\n            <a class=\"navbar-brand\" href=\"#\">\n                <img alt=\"\" src=\"https://console-dal10-red.cdn.s-bluemix.net/cache/b86-87010155/api/v6/img/ibm-cloud-logo-white.svg\">\n                <h2 class=\"bx--logo__text\">IBM&nbsp;<span class=\"bx--logo__text--bold\">Cloud</span></h2><h4 class=\"bx--global-header__title--current-page\">Demo</h4>\n            </a> \n            \n        </div>\n        <div id=\"navbar\" class=\"navbar-collapse collapse\">\n            <ul class=\"nav navbar-nav navbar-right\">\n                <li><a target=\"_blank\" href=\"https://console.bluemix.net/registration/?target=%2Fdashboard%2Fapps\">Start Free Today!</a></li>\n                <li><a target=\"_blank\" href=\"https://www-01.ibm.com/marketing/iwm/dre/signup?source=MAIL-watson&disableCookie=Yes\">Contact Us</a></li>\n            </ul>\n        </div>\n      </div>\n    </nav>\n    <div class=\"jumbotron\">\n      <div class=\"container\">\n            <div class=\"col-md-4\">\n                <div class=\"input-group mb-3\">\n                                <input id=\"phoneInput\" name=\"phoneInput\" type=\"text\" class=\"form-control\" placeholder=\"Phone Number\" aria-label=\"Phone Number\" aria-describedby=\"basic-addon2\">\n                                <span class=\"input-group-btn\">\n                                    <button id=\"btnPhone\" type=\"submit\" class=\"btn btn-primary\"><i class=\"fa fa-download fa-rotate-270\" aria-hidden=\"true\"></i></button>\n                                </span>\n                            </div>\n            </div>\n            <div class=\"col-md-4\">\n                <p>Agent control panel</p>\n            </div>\n            <div class=\"col-md-4\">\n            </div>\n      </div>\n    </div>\n<div class=\"container\">\n    <div class=\"row\">\n        <div class=\"col-md-4\">\n            <div class=\"panel panel-default\" style=\"margin-bottom: 0px;padding-bottom: 0px;\"\">\n                <div class=\"panel-heading\">Customer Chat</div>\n                <div class=\"panel-body\">\n                        <ul class=\"chat\" id=\"chat\">\n                     \n                        </ul>\n                </div>\n            </div>\n        </div>\n        <div class=\"col-md-8\">\n            <div class=\"panel panel-default\" style=\"margin-bottom: 0px;padding-bottom: 0px;\">\n                      <div style=\"height:900px\" id=\"sentiment\" ></div>\n            </div>\n        </div>\n    </div>\n</div>\n  </body>\n    <script src=\"/jsagent\"></script>\n    <script src=\"/cognos\"></script>\n    <script src=\"/CognosApi\"></script>    \n\n  </html>","output":"str","x":320,"y":300,"wires":[["e231925c.1f10f8"]]},{"id":"e231925c.1f10f8","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"text/html","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":300,"wires":[["d2fb143e.e7974"]]},{"id":"170c1305.66782d","type":"http in","z":"8246e271.253b4","name":"","url":"/agent","method":"get","upload":false,"swaggerDoc":"","x":170,"y":300,"wires":[["f67ff127.25956"]]},{"id":"6b3dbdd4.cf8374","type":"http in","z":"8246e271.253b4","name":"","url":"/jsagent","method":"get","upload":false,"swaggerDoc":"","x":170,"y":340,"wires":[["5f6d9a1d.e7c424"]]},{"id":"d6199871.66a72","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/javascript","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":340,"wires":[["d2fb143e.e7974"]]},{"id":"5f6d9a1d.e7c424","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"javascript","syntax":"plain","template":"var getUrlParameter = function getUrlParameter(sParam) {\n    var sPageURL = decodeURIComponent(window.location.search.substring(1)),\n        sURLVariables = sPageURL.split('&'),\n        sParameterName,\n        i;\n\n    for (i = 0; i < sURLVariables.length; i++) {\n        sParameterName = sURLVariables[i].split('=');\n\n        if (sParameterName[0] === sParam) {\n            return sParameterName[1] === undefined ? true : sParameterName[1];\n        }\n    }\n};\n\nvar chartDate = new Date( Date.now() - (5000 * 60) ).toISOString().substr(0, 23);\n\nvar socket;\n\nattempts = 0\n\n\nyourPhone = getUrlParameter('yourPhone');\n$(\"#phoneInput\").val(yourPhone);\nagentPhone = getUrlParameter('agentPhone');\n\n\n$(\"#btnPhone\").click(function(){\n    var url = \"https://customerconcierge.mybluemix.net/agent?yourPhone=\" + $(\"#phoneInput\").val();\n      document.location = url;\n});\n\n\nfunction updateChat(update){\n    watsonTextArea.value += update;\n    watsonTextArea.scrollTop = watsonTextArea.scrollHeight;\n}\nfunction connect(){\n    var host = \"wss://customerconcierge.mybluemix.net/ws/listener\";\n    try{\n        socket = new WebSocket(host);\n        socket.onopen = function(){console.log(\"socket connected\");}\n        socket.onmessage = function(msg){\n            var json = JSON.parse(msg.data);\n            if(json.user == yourPhone){\n                $(\"#chat\").prepend(json.chat);\n            }\n        }\n        socket.onclose = function () {\n            console.log(\"socket closed\");\n            var time = generateInterval(attempts);\n            setTimeout(function () {\n                attempts++;\n                connect(); \n            }, time);\n        }\n    } catch(exception){console.log('Socket Error: '+exception);}\n    function send(){\n        var text = \"\";\n        try{\n            socket.send(text);\n        } catch(exception){console.log('Socket Error: '+exception);}\n    }\n    function generateInterval (k) {\n        var maxInterval = (Math.pow(2, k) - 1) * 1000;\n        if (maxInterval > 30*1000) {\n            maxInterval = 30*1000; \n        }\n        return Math.random() * maxInterval; \n    }\n}\nif(!(\"WebSocket\" in window)){}\nelse{\n    connect();\n}","x":320,"y":340,"wires":[["d6199871.66a72"]]},{"id":"d2fb143e.e7974","type":"http response","z":"8246e271.253b4","name":"","statusCode":"","headers":{},"x":690,"y":320,"wires":[]},{"id":"8303cd25.a21868","type":"natural-language-understanding","z":"45bfaeea.5a7458","name":"NLU","categories":false,"concepts":false,"maxconcepts":"8","doc-emotion":false,"doc-emotion-target":"","doc-sentiment":true,"doc-sentiment-target":"","entity":false,"entity-emotion":false,"entity-sentiment":false,"maxentities":"50","keyword":false,"keyword-emotion":false,"keyword-sentiment":false,"maxkeywords":"50","metadata":false,"relation":false,"semantic":false,"semantic-entities":false,"semantic-keywords":false,"maxsemantics":"50","default-endpoint":true,"service-endpoint":"https://gateway.watsonplatform.net/natural-language-understanding/api","x":210,"y":811,"wires":[["5ca996f1.bec39"]]},{"id":"8f97c546.48e47","type":"dashDB out","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","table":"SENTIMENT","name":"Sentiment","x":510,"y":811,"wires":[]},{"id":"5ca996f1.bec39","type":"function","z":"45bfaeea.5a7458","name":"","func":"t = msg;\nmsg.payload =\n{\n    ETIME: 'TIMESTAMP',\n    USER : t.user,\n    SCORE : t.features.sentiment.document.score\n}\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":811,"wires":[["8f97c546.48e47"]]},{"id":"6d44180d.2e0218","type":"link in","z":"45bfaeea.5a7458","name":"NLU","links":["8899dcc9.ab69f","2498bfbf.def71","c0cbc967.05a908","546a9a80.8a6ee4"],"x":115,"y":811,"wires":[["8303cd25.a21868"]]},{"id":"8899dcc9.ab69f","type":"link out","z":"45bfaeea.5a7458","name":"","links":["6d44180d.2e0218","6b34a7d0.3a2ed8"],"x":835,"y":220,"wires":[]},{"id":"c0cbc967.05a908","type":"link out","z":"45bfaeea.5a7458","name":"Watson","links":["6d44180d.2e0218"],"x":1015,"y":320,"wires":[]},{"id":"3fe4da4b.49ca5e","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"var dashSpec =  {\n \t\"name\": \"New dashboard\",\n \t\"layout\": {\n \t\t\"id\": \"page0\",\n \t\t\"items\": [\n\t\t  {\n \t\t\t\t\"id\": \"page1\",\n \t\t\t\t\"items\": [{\n \t\t\t\t\t\t\"id\": \"model00000163f5e901e2_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"240px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model00000163faa38c50_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"240px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model00000163faae1960_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"380px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model00000164008cb5ce_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"240px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model000001640098ef5a_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"240px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model00000164009d22c0_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"190px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model00000164009fd2d2_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"200px\",\n \t\t\t\t\t\t\t\"width\": \"190px\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"id\": \"model0000016401b3c240_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"115px\",\n \t\t\t\t\t\t\t\"width\": \"100%\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t}\n\n \t\t\t\t],\n \t\t\t\t\"type\": \"absolute\",\n \t\t\t\t\"title\": \"Dashboard\",\n \t\t\t\t\"templateName\": \"NoTemplate\"\n \t\t\t},\n \t\t\t{\n \t\t\t\t\"id\": \"model0000016401ab1e7a_00000000\",\n \t\t\t\t\"items\": [],\n \t\t\t\t\"type\": \"absolute\",\n \t\t\t\t\"title\": \"Account Info\",\n \t\t\t\t\"templateName\": \"NoTemplate\"\n \t\t\t},\n\t\t  {\n \t\t\t\t\"id\": \"discoveryPage\",\n \t\t\t\t\"items\": [{\n \t\t\t\t\t\t\"id\":  \"model00000164619c2635_00000000\",\n \t\t\t\t\t\t\"style\": {\n \t\t\t\t\t\t\t\"height\": \"100%\",\n \t\t\t\t\t\t\t\"width\": \"100%\",\n \t\t\t\t\t\t\t\"float\": \"left\",\n \t\t\t\t\t\t\t\"position\": \"relative\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"type\": \"widget\"\n \t\t\t\t\t}],\n \t\t\t\t\"type\": \"absolute\",\n \t\t\t\t\"title\": \"Discovery Call Log\",\n \t\t\t\t\"templateName\": \"NoTemplate\"\n \t\t\t}\n \t\t],\n \t\t\"style\": {\n \t\t\t\"height\": \"100%\"\n \t\t},\n \t\t\"type\": \"tab\"\n \t},\n \t\"theme\": \"defaultTheme\",\n \t\"version\": 1008,\n \t\"eventGroups\": [{\n \t\t\"id\": \"page0:1\",\n \t\t\"widgetIds\": [\"model00000163f5e901e2_00000000\"]\n \t}],\n \t\"dataSources\": {\n \t\t\"version\": \"1.0\",\n \t\t\"sources\": [{\n \t\t\t\t\"id\": \"model00000163f5e8d8dc_00000001\",\n \t\t\t\t\"assetId\": \"assetId00000163f5e8d8da_00000000\",\n \t\t\t\t\"clientId\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\"module\": {\n \t\t\t\t\t\"xsd\": \"https://ibm.com/daas/module/1.0/module.xsd\",\n \t\t\t\t\t\"source\": {\n \t\t\t\t\t\t\"id\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\t\t\"user\": \"dash5337\",\n \t\t\t\t\t\t\"password\": \"5rg0CUpk__TM\",\n \t\t\t\t\t\t\"jdbc\": {\n \t\t\t\t\t\t\t\"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n \t\t\t\t\t\t\t\"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n \t\t\t\t\t\t\t\"schema\": \"DASH5337\"\n \t\t\t\t\t\t}\n \t\t\t\t\t},\n \t\t\t\t\t\"label\": \"SENTIMENT\",\n \t\t\t\t\t\"identifier\": \"SENTIMENT\",\n \t\t\t\t\t\"table\": {\n \t\t\t\t\t\t\"column\": [{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(15)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"USER\",\n \t\t\t\t\t\t\t\t\"label\": \"USER\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"timestamp\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"ETIME\",\n \t\t\t\t\t\t\t\t\"label\": \"ETIME\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"decimal(8)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"SCORE\",\n \t\t\t\t\t\t\t\t\"label\": \"SCORE\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"total\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"name\": \"SENTIMENT\",\n \t\t\t\t\t\t\"description\": \"\"\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t\"name\": \"SENTIMENT\",\n \t\t\t\t\"shaping\": {\n \t\t\t\t\t\"embeddedModuleUpToDate\": true\n \t\t\t\t}\n \t\t\t},\n \t\t\t{\n \t\t\t\t\"id\": \"model00000163fa696206_00000001\",\n \t\t\t\t\"assetId\": \"assetId00000163fa696204_00000000\",\n \t\t\t\t\"clientId\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_CLASSIFICATION:table\",\n \t\t\t\t\"module\": {\n \t\t\t\t\t\"xsd\": \"https://ibm.com/daas/module/1.0/module.xsd\",\n \t\t\t\t\t\"source\": {\n \t\t\t\t\t\t\"id\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\t\t\"user\": \"dash5337\",\n \t\t\t\t\t\t\"password\": \"5rg0CUpk__TM\",\n \t\t\t\t\t\t\"jdbc\": {\n \t\t\t\t\t\t\t\"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n \t\t\t\t\t\t\t\"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n \t\t\t\t\t\t\t\"schema\": \"DASH5337\"\n \t\t\t\t\t\t}\n \t\t\t\t\t},\n \t\t\t\t\t\"label\": \"CALL_CLASSIFICATION\",\n \t\t\t\t\t\"identifier\": \"CALL_CLASSIFICATION\",\n \t\t\t\t\t\"table\": {\n \t\t\t\t\t\t\"column\": [{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(15)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"USER\",\n \t\t\t\t\t\t\t\t\"label\": \"USER\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"CLASS_NAME\",\n \t\t\t\t\t\t\t\t\"label\": \"CLASS_NAME\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"decimal(8)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"CONFIDENCE\",\n \t\t\t\t\t\t\t\t\"label\": \"CONFIDENCE\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"name\": \"CALL_CLASSIFICATION\",\n \t\t\t\t\t\t\"description\": \"\"\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t\"name\": \"CALL_CLASSIFICATION\",\n \t\t\t\t\"shaping\": {\n \t\t\t\t\t\"shapingId\": \"shaping00000163faa87bbe_00000000\",\n \t\t\t\t\t\"embeddedModuleUpToDate\": false,\n \t\t\t\t\t\"moserJSON\": {\n \t\t\t\t\t\t\"version\": \"5.0\",\n \t\t\t\t\t\t\"container\": \"C\",\n \t\t\t\t\t\t\"useSpec\": [{\n \t\t\t\t\t\t\t\"identifier\": \"ES\",\n \t\t\t\t\t\t\t\"type\": \"url\",\n \t\t\t\t\t\t\t\"storeID\": \"baseModule\",\n \t\t\t\t\t\t\t\"imports\": \"*\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"expressionLocale\": \"en-us\",\n \t\t\t\t\t\t\"querySubject\": [{\n \t\t\t\t\t\t\t\"ref\": [\"ES.CALL_CLASSIFICATION\"],\n \t\t\t\t\t\t\t\"instanceType\": \"reference\",\n \t\t\t\t\t\t\t\"item\": [{\n \t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\t\"regularAggregate\": \"none\",\n \t\t\t\t\t\t\t\t\t\"identifier\": \"CONFIDENCE\",\n \t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_170\",\n \t\t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_165\",\n \t\t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t\t]\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}],\n \t\t\t\t\t\t\t\"identifier\": \"CALL_CLASSIFICATION\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"dataRetrievalMode\": \"liveConnection\",\n \t\t\t\t\t\t\"identifier\": \"newModel\",\n \t\t\t\t\t\t\"label\": \"newModel\"\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t},\n \t\t\t{\n \t\t\t\t\"id\": \"model00000163fa699ad8_00000001\",\n \t\t\t\t\"assetId\": \"assetId00000163fa699ad2_00000000\",\n \t\t\t\t\"clientId\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_TONE:table\",\n \t\t\t\t\"module\": {\n \t\t\t\t\t\"xsd\": \"https://ibm.com/daas/module/1.0/module.xsd\",\n \t\t\t\t\t\"source\": {\n \t\t\t\t\t\t\"id\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\t\t\"user\": \"dash5337\",\n \t\t\t\t\t\t\"password\": \"5rg0CUpk__TM\",\n \t\t\t\t\t\t\"jdbc\": {\n \t\t\t\t\t\t\t\"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n \t\t\t\t\t\t\t\"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n \t\t\t\t\t\t\t\"schema\": \"DASH5337\"\n \t\t\t\t\t\t}\n \t\t\t\t\t},\n \t\t\t\t\t\"label\": \"CALL_TONE\",\n \t\t\t\t\t\"identifier\": \"CALL_TONE\",\n \t\t\t\t\t\"table\": {\n \t\t\t\t\t\t\"column\": [{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(15)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"USER\",\n \t\t\t\t\t\t\t\t\"label\": \"USER\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"TONE_NAME\",\n \t\t\t\t\t\t\t\t\"label\": \" \",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"decimal(8)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"SCORE\",\n \t\t\t\t\t\t\t\t\"label\": \"SCORE\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"total\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"name\": \"CALL_TONE\",\n \t\t\t\t\t\t\"description\": \"\"\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t\"name\": \"CALL_TONE\",\n \t\t\t\t\"shaping\": {\n \t\t\t\t\t\"shapingId\": \"shaping00000163fab09cd8_00000000\",\n \t\t\t\t\t\"embeddedModuleUpToDate\": false,\n \t\t\t\t\t\"moserJSON\": {\n \t\t\t\t\t\t\"version\": \"5.0\",\n \t\t\t\t\t\t\"container\": \"C\",\n \t\t\t\t\t\t\"useSpec\": [{\n \t\t\t\t\t\t\t\"identifier\": \"ES\",\n \t\t\t\t\t\t\t\"type\": \"url\",\n \t\t\t\t\t\t\t\"storeID\": \"baseModule\",\n \t\t\t\t\t\t\t\"imports\": \"*\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"expressionLocale\": \"en-us\",\n \t\t\t\t\t\t\"querySubject\": [{\n \t\t\t\t\t\t\t\"ref\": [\"ES.CALL_TONE\"],\n \t\t\t\t\t\t\t\"instanceType\": \"reference\",\n \t\t\t\t\t\t\t\"item\": [{\n \t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\"usage\": \"identifier\",\n \t\t\t\t\t\t\t\t\t\"identifier\": \"USER_\",\n \t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_165\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t}]\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}],\n \t\t\t\t\t\t\t\"identifier\": \"CALL_TONE\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"dataRetrievalMode\": \"liveConnection\",\n \t\t\t\t\t\t\"identifier\": \"newModel\",\n \t\t\t\t\t\t\"label\": \"newModel\"\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t},\n \t\t\t{\n \t\t\t\t\"id\": \"model0000016400368196_00000001\",\n \t\t\t\t\"assetId\": \"assetId0000016400368194_00000000\",\n \t\t\t\t\"clientId\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_UPSELL:table\",\n \t\t\t\t\"module\": {\n \t\t\t\t\t\"xsd\": \"https://ibm.com/daas/module/1.0/module.xsd\",\n \t\t\t\t\t\"source\": {\n \t\t\t\t\t\t\"id\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\t\t\"user\": \"dash5337\",\n \t\t\t\t\t\t\"password\": \"5rg0CUpk__TM\",\n \t\t\t\t\t\t\"jdbc\": {\n \t\t\t\t\t\t\t\"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n \t\t\t\t\t\t\t\"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n \t\t\t\t\t\t\t\"schema\": \"DASH5337\"\n \t\t\t\t\t\t}\n \t\t\t\t\t},\n \t\t\t\t\t\"label\": \"CALL_UPSELL\",\n \t\t\t\t\t\"identifier\": \"CALL_UPSELL\",\n \t\t\t\t\t\"table\": {\n \t\t\t\t\t\t\"column\": [{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(15)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"USER\",\n \t\t\t\t\t\t\t\t\"label\": \"USER\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"PRODUCT\",\n \t\t\t\t\t\t\t\t\"label\": \"PRODUCT\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"decimal(8)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"PROBABILITY\",\n \t\t\t\t\t\t\t\t\"label\": \"PROBABILITY\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"total\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"name\": \"CALL_UPSELL\",\n \t\t\t\t\t\t\"description\": \"\"\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t\"name\": \"CALL_UPSELL\",\n \t\t\t\t\"shaping\": {\n \t\t\t\t\t\"shapingId\": \"shaping000001640063ab24_00000000\",\n \t\t\t\t\t\"embeddedModuleUpToDate\": false,\n \t\t\t\t\t\"moserJSON\": {\n \t\t\t\t\t\t\"version\": \"5.0\",\n \t\t\t\t\t\t\"container\": \"C\",\n \t\t\t\t\t\t\"useSpec\": [{\n \t\t\t\t\t\t\t\"identifier\": \"ES\",\n \t\t\t\t\t\t\t\"type\": \"url\",\n \t\t\t\t\t\t\t\"storeID\": \"baseModule\",\n \t\t\t\t\t\t\t\"imports\": \"*\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"expressionLocale\": \"en-us\",\n \t\t\t\t\t\t\"querySubject\": [{\n \t\t\t\t\t\t\t\"ref\": [\"ES.CALL_UPSELL\"],\n \t\t\t\t\t\t\t\"instanceType\": \"reference\",\n \t\t\t\t\t\t\t\"item\": [{\n \t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\"regularAggregate\": \"maximum\",\n \t\t\t\t\t\t\t\t\t\"identifier\": \"PROBABILITY\",\n \t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_170\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t}]\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}],\n \t\t\t\t\t\t\t\"identifier\": \"CALL_UPSELL\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"dataRetrievalMode\": \"liveConnection\",\n \t\t\t\t\t\t\"identifier\": \"newModel\",\n \t\t\t\t\t\t\"label\": \"newModel\"\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t},\n \t\t\t{\n \t\t\t\t\"id\": \"model0000016400833ab8_00000000\",\n \t\t\t\t\"assetId\": \"assetId0000016400833ab6_00000000\",\n \t\t\t\t\"clientId\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/USERS:table\",\n \t\t\t\t\"module\": {\n \t\t\t\t\t\"xsd\": \"https://ibm.com/daas/module/1.0/module.xsd\",\n \t\t\t\t\t\"source\": {\n \t\t\t\t\t\t\"id\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\t\t\"user\": \"dash5337\",\n \t\t\t\t\t\t\"password\": \"5rg0CUpk__TM\",\n \t\t\t\t\t\t\"jdbc\": {\n \t\t\t\t\t\t\t\"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n \t\t\t\t\t\t\t\"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n \t\t\t\t\t\t\t\"schema\": \"DASH5337\"\n \t\t\t\t\t\t}\n \t\t\t\t\t},\n \t\t\t\t\t\"label\": \"USERS\",\n \t\t\t\t\t\"identifier\": \"USERS\",\n \t\t\t\t\t\"table\": {\n \t\t\t\t\t\t\"column\": [{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(11)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"ID\",\n \t\t\t\t\t\t\t\t\"label\": \"ID\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(1)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"GENDER\",\n \t\t\t\t\t\t\t\t\"label\": \"Sex\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"smallint\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"AGE\",\n \t\t\t\t\t\t\t\t\"label\": \"Age\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"MAIDEN_NAME\",\n \t\t\t\t\t\t\t\t\"label\": \"MAIDEN_NAME\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"LNAME\",\n \t\t\t\t\t\t\t\t\"label\": \"Last\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"FNAME\",\n \t\t\t\t\t\t\t\t\"label\": \"First\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"ADDRESS\",\n \t\t\t\t\t\t\t\t\"label\": \"Address\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cStreetAddress\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"CITY\",\n \t\t\t\t\t\t\t\t\"label\": \"City\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cCity\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"STATE\",\n \t\t\t\t\t\t\t\t\"label\": \"STATE\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cStateProvince\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"integer\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"ZIP\",\n \t\t\t\t\t\t\t\t\"label\": \"ZIP\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"total\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cPostalCode\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"COUNTRY\",\n \t\t\t\t\t\t\t\t\"label\": \"COUNTRY\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cCountry\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"bigint\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"PHONE\",\n \t\t\t\t\t\t\t\t\"label\": \"Phone\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(255)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"EMAIL\",\n \t\t\t\t\t\t\t\t\"label\": \"EMAIL\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(19)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"CC_NUMBER\",\n \t\t\t\t\t\t\t\t\"label\": \"CC_NUMBER\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"smallint\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"MONTHLY_PAYMENT\",\n \t\t\t\t\t\t\t\t\"label\": \"Payment\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cMonth\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"smallint\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"TOTAL_PAYMENTS\",\n \t\t\t\t\t\t\t\t\"label\": \"TOTAL_PAYMENTS\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"total\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"name\": \"USERS\",\n \t\t\t\t\t\t\"description\": \"\"\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t\"name\": \"USERS\",\n \t\t\t\t\"shaping\": {\n \t\t\t\t\t\"shapingId\": \"shaping0000016400adfdbe_00000000\",\n \t\t\t\t\t\"embeddedModuleUpToDate\": false,\n \t\t\t\t\t\"moserJSON\": {\n \t\t\t\t\t\t\"version\": \"5.0\",\n \t\t\t\t\t\t\"container\": \"C\",\n \t\t\t\t\t\t\"useSpec\": [{\n \t\t\t\t\t\t\t\"identifier\": \"ES\",\n \t\t\t\t\t\t\t\"type\": \"url\",\n \t\t\t\t\t\t\t\"storeID\": \"baseModule\",\n \t\t\t\t\t\t\t\"imports\": \"*\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"expressionLocale\": \"en-us\",\n \t\t\t\t\t\t\"querySubject\": [{\n \t\t\t\t\t\t\t\"ref\": [\"ES.USERS\"],\n \t\t\t\t\t\t\t\"instanceType\": \"reference\",\n \t\t\t\t\t\t\t\"item\": [{\n \t\t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\t\"regularAggregate\": \"none\",\n \t\t\t\t\t\t\t\t\t\t\"identifier\": \"ADDRESS\",\n \t\t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_170\",\n \t\t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t\t}]\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\t\"regularAggregate\": \"none\",\n \t\t\t\t\t\t\t\t\t\t\"identifier\": \"CITY\",\n \t\t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_170\",\n \t\t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t\t}]\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\t\t\"regularAggregate\": \"maximum\",\n \t\t\t\t\t\t\t\t\t\t\"identifier\": \"TOTAL_PAYMENTS\",\n \t\t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_170\",\n \t\t\t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_165\",\n \t\t\t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t\t\t]\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t],\n \t\t\t\t\t\t\t\"identifier\": \"USERS\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"calculation\": [{\n \t\t\t\t\t\t\t\t\"expression\": \"maximum(USERS.TOTAL_PAYMENTS)\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"datatype\": \"SMALLINT\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"calculated\",\n \t\t\t\t\t\t\t\t\"datatypeCategory\": \"number\",\n \t\t\t\t\t\t\t\t\"highlevelDatatype\": \"integer\",\n \t\t\t\t\t\t\t\t\"facetDefinition\": {\n \t\t\t\t\t\t\t\t\t\"enabled\": \"automatic\"\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\"identifier\": \"Calculation_name\",\n \t\t\t\t\t\t\t\t\"label\": \"Group Total\",\n \t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"ui_expr\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"{\\\"func\\\":\\\"customCalculation\\\",\\\"version\\\":\\\"5.0\\\"}\"\n \t\t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_116\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t],\n \t\t\t\t\t\t\t\t\"propertyOverride\": [\"NEW\"]\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"expression\": \"total(\\nif (USERS.PHONE = \" + yourPhone + \")\\nthen (USERS.TOTAL_PAYMENTS)\\nelse (null)\\n\\n)\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"datatype\": \"SMALLINT\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"calculated\",\n \t\t\t\t\t\t\t\t\"datatypeCategory\": \"number\",\n \t\t\t\t\t\t\t\t\"highlevelDatatype\": \"integer\",\n \t\t\t\t\t\t\t\t\"facetDefinition\": {\n \t\t\t\t\t\t\t\t\t\"enabled\": \"automatic\"\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\"identifier\": \"Calculation_name_1\",\n \t\t\t\t\t\t\t\t\"label\": \"User Total\",\n \t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"ui_expr\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"{\\\"func\\\":\\\"customCalculation\\\",\\\"version\\\":\\\"5.0\\\"}\"\n \t\t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_116\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t],\n \t\t\t\t\t\t\t\t\"propertyOverride\": [\"NEW\"]\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"expression\": \"Calculation_name_1/ Calculation_name\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"datatype\": \"DOUBLE\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"calculated\",\n \t\t\t\t\t\t\t\t\"datatypeCategory\": \"number\",\n \t\t\t\t\t\t\t\t\"highlevelDatatype\": \"decimal\",\n \t\t\t\t\t\t\t\t\"facetDefinition\": {\n \t\t\t\t\t\t\t\t\t\"enabled\": \"automatic\"\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\"identifier\": \"Calculation_name_2\",\n \t\t\t\t\t\t\t\t\"label\": \"uvalue\",\n \t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"ui_expr\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"{\\\"func\\\":\\\"customCalculation\\\",\\\"version\\\":\\\"5.0\\\"}\"\n \t\t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_116\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\t],\n \t\t\t\t\t\t\t\t\"propertyOverride\": [\"NEW\"]\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"metadataTreeView\": [{\n \t\t\t\t\t\t\t\"folderItem\": [{\n \t\t\t\t\t\t\t\t\t\"ref\": \"Calculation_name\"\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\"ref\": \"Calculation_name_1\"\n \t\t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\t\"ref\": \"Calculation_name_2\"\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t]\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"dataRetrievalMode\": \"liveConnection\",\n \t\t\t\t\t\t\"identifier\": \"newModel\",\n \t\t\t\t\t\t\"label\": \"newModel\"\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t},\n \t\t\t{\n \t\t\t\t\"id\": \"model00000164009cf3ae_00000002\",\n \t\t\t\t\"assetId\": \"assetId00000164009cf3ae_00000000\",\n \t\t\t\t\"clientId\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_RISK:table\",\n \t\t\t\t\"module\": {\n \t\t\t\t\t\"xsd\": \"https://ibm.com/daas/module/1.0/module.xsd\",\n \t\t\t\t\t\"source\": {\n \t\t\t\t\t\t\"id\": \"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n \t\t\t\t\t\t\"user\": \"dash5337\",\n \t\t\t\t\t\t\"password\": \"5rg0CUpk__TM\",\n \t\t\t\t\t\t\"jdbc\": {\n \t\t\t\t\t\t\t\"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n \t\t\t\t\t\t\t\"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n \t\t\t\t\t\t\t\"schema\": \"DASH5337\"\n \t\t\t\t\t\t}\n \t\t\t\t\t},\n \t\t\t\t\t\"label\": \"CALL_RISK\",\n \t\t\t\t\t\"identifier\": \"CALL_RISK\",\n \t\t\t\t\t\"table\": {\n \t\t\t\t\t\t\"column\": [{\n \t\t\t\t\t\t\t\t\"datatype\": \"varchar(15)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"USER\",\n \t\t\t\t\t\t\t\t\"label\": \"USER\",\n \t\t\t\t\t\t\t\t\"usage\": \"attribute\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"countDistinct\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t},\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\t\"datatype\": \"decimal(8)\",\n \t\t\t\t\t\t\t\t\"nullable\": true,\n \t\t\t\t\t\t\t\t\"name\": \"RISK\",\n \t\t\t\t\t\t\t\t\"label\": \"RISK\",\n \t\t\t\t\t\t\t\t\"usage\": \"fact\",\n \t\t\t\t\t\t\t\t\"regularAggregate\": \"total\",\n \t\t\t\t\t\t\t\t\"taxonomyFamily\": \"cNone\"\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t],\n \t\t\t\t\t\t\"name\": \"CALL_RISK\",\n \t\t\t\t\t\t\"description\": \"\"\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t\"name\": \"CALL_RISK\",\n \t\t\t\t\"shaping\": {\n \t\t\t\t\t\"shapingId\": \"shaping00000164009d5fb8_00000000\",\n \t\t\t\t\t\"embeddedModuleUpToDate\": false,\n \t\t\t\t\t\"moserJSON\": {\n \t\t\t\t\t\t\"version\": \"5.0\",\n \t\t\t\t\t\t\"container\": \"C\",\n \t\t\t\t\t\t\"useSpec\": [{\n \t\t\t\t\t\t\t\"identifier\": \"ES\",\n \t\t\t\t\t\t\t\"type\": \"url\",\n \t\t\t\t\t\t\t\"storeID\": \"baseModule\",\n \t\t\t\t\t\t\t\"imports\": \"*\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"expressionLocale\": \"en-us\",\n \t\t\t\t\t\t\"querySubject\": [{\n \t\t\t\t\t\t\t\"ref\": [\"ES.CALL_RISK\"],\n \t\t\t\t\t\t\t\"instanceType\": \"reference\",\n \t\t\t\t\t\t\t\"item\": [{\n \t\t\t\t\t\t\t\t\"queryItem\": {\n \t\t\t\t\t\t\t\t\t\"regularAggregate\": \"none\",\n \t\t\t\t\t\t\t\t\t\"identifier\": \"RISK\",\n \t\t\t\t\t\t\t\t\t\"property\": [{\n \t\t\t\t\t\t\t\t\t\t\"name\": \"propertySetByUser_170\",\n \t\t\t\t\t\t\t\t\t\t\"value\": \"true\"\n \t\t\t\t\t\t\t\t\t}]\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t}],\n \t\t\t\t\t\t\t\"identifier\": \"CALL_RISK\"\n \t\t\t\t\t\t}],\n \t\t\t\t\t\t\"dataRetrievalMode\": \"liveConnection\",\n \t\t\t\t\t\t\"identifier\": \"newModel\",\n \t\t\t\t\t\t\"label\": \"newModel\"\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n \t\t]\n \t},\n \t\"pageContext\": [],\n \t\"drillThrough\": [],\n \t\"widgets\": {\n \t\t\"model00000163f5e901e2_00000000\": {\n \t\t\t\"id\": \"model00000163f5e901e2_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model00000163f5e8d8dc_00000001\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\t\"id\": \"model00000163f5e92ada_00000001\",\n \t\t\t\t\t\t\t\"itemId\": \"SENTIMENT.ETIME\",\n \t\t\t\t\t\t\t\"itemLabel\": \"ETIME\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model00000163f5e938cc_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"SENTIMENT.SCORE\",\n \t\t\t\t\t\t\t\"itemLabel\": \"SCORE\"\n \t\t\t\t\t\t}\n \t\t\t\t\t],\n \t\t\t\t\t\"id\": \"model00000163f5e92ada_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\t\"name\": \"categories\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163f5e92ada_00000001\"],\n \t\t\t\t\t\t\"dataItemSettings\": [],\n \t\t\t\t\t\t\"caption\": \"x-axis\",\n \t\t\t\t\t\t\"id\": \"categories\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"name\": \"values\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163f5e938cc_00000000\"],\n \t\t\t\t\t\t\"caption\": \"y-axis\",\n \t\t\t\t\t\t\"id\": \"values\"\n \t\t\t\t\t}\n \t\t\t\t]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"com.ibm.vis.rave2line\",\n \t\t\t\"name\": \"Sentiment\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\t\"id\": \"SENTIMENT.USER_\",\n \t\t\t\t\t\"columnId\": \"SENTIMENT.USER_\",\n \t\t\t\t\t\"values\": [{\n \t\t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\t\"u\": \"SENTIMENT.USER_->[\" + yourPhone + \"]\"\n \t\t\t\t\t}],\n \t\t\t\t\t\"excludedValues\": [],\n \t\t\t\t\t\"operator\": \"in\",\n \t\t\t\t\t\"type\": null\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"SENTIMENT.ETIME\",\n \t\t\t\t\t\"columnId\": \"SENTIMENT.ETIME\",\n \t\t\t\t\t\"values\": [{\n \t\t\t\t\t\t\"d\": chartDate,\n \t\t\t\t\t\t\"u\": chartDate\n \t\t\t\t\t}],\n \t\t\t\t\t\"excludedValues\": [],\n \t\t\t\t\t\"operator\": \"gt\",\n \t\t\t\t\t\"preOrPost\": \"post\"\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"properties\": [{\n \t\t\t\t\t\"id\": \"gridLines.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"itemAxis.labels.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"lines.smooth\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"markers.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"titles.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"valueAxis.zeroOrigin\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"valueAxis.labels.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"itemAxis.labels.layoutMode\",\n \t\t\t\t\t\"value\": \"rotate45\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisLabelColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.5,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"maintainAxisScales\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisTitleFontColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.6,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"legendTitleColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.5,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"legendBodyColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.5,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisLineColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.25,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisGridLineColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.05,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"elementsLabelColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.6,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": true,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 2,\n \t\t\t\t\"lastRefreshed\": 1528919583052\n \t\t\t},\n \t\t\t\"fillColor\": \"transparent\",\n \t\t\t\"showTitle\": true\n \t\t},\n \t\t\"model00000163faa38c50_00000000\": {\n \t\t\t\"id\": \"model00000163faa38c50_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model00000163fa696206_00000001\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\t\"id\": \"model00000163faa3afbe_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_CLASSIFICATION.CONFIDENCE\",\n \t\t\t\t\t\t\t\"itemLabel\": \"CONFIDENCE\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model00000163faa3b63e_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_CLASSIFICATION.CLASS_NAME\",\n \t\t\t\t\t\t\t\"itemLabel\": \"CLASS_NAME\"\n \t\t\t\t\t\t}\n \t\t\t\t\t],\n \t\t\t\t\t\"id\": \"model00000163faa3afbc_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\t\"name\": \"categories\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163faa3b63e_00000000\"],\n \t\t\t\t\t\t\"dataItemSettings\": [],\n \t\t\t\t\t\t\"caption\": \"Words\",\n \t\t\t\t\t\t\"id\": \"categories\",\n \t\t\t\t\t\t\"layerId\": \"data\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"name\": \"size\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163faa3afbe_00000000\"],\n \t\t\t\t\t\t\"caption\": \"Size\",\n \t\t\t\t\t\t\"id\": \"size\",\n \t\t\t\t\t\t\"layerId\": \"data\"\n \t\t\t\t\t}\n \t\t\t\t]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"com.ibm.vis.rave2bundlewordcloud\",\n \t\t\t\"name\": \"Call Classification\",\n \t\t\t\"fillColor\": \"transparent\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\"id\": \"CALL_CLASSIFICATION.USER_\",\n \t\t\t\t\"columnId\": \"CALL_CLASSIFICATION.USER_\",\n \t\t\t\t\"values\": [{\n \t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\"u\": \"CALL_CLASSIFICATION.USER_->[\" + yourPhone + \"]\"\n \t\t\t\t}],\n \t\t\t\t\"excludedValues\": [],\n \t\t\t\t\"operator\": \"in\",\n \t\t\t\t\"type\": null\n \t\t\t}],\n \t\t\t\"showTitle\": true,\n \t\t\t\"properties\": [{\n \t\t\t\t\t\"id\": \"word.orientation\",\n \t\t\t\t\t\"value\": \"horizontal\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"widget.legend.position\",\n \t\t\t\t\t\"value\": \"bottom\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"widget.legend.display\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"dial.roundedEnds\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"contrast.label.color\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"label.shadow\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"labels.visible\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"donutRadius\",\n \t\t\t\t\t\"value\": 1\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"label.percentage\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"labelLocation\",\n \t\t\t\t\t\"value\": \"none\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisTitleFontColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.6,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"legendTitleColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.5,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"legendBodyColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.5,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisLabelColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.5,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisLineColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.25,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"axisGridLineColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.05,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"elementsLabelColor\",\n \t\t\t\t\t\"value\": {\n \t\t\t\t\t\t\"a\": 0.6,\n \t\t\t\t\t\t\"r\": 0,\n \t\t\t\t\t\t\"g\": 0,\n \t\t\t\t\t\t\"b\": 0\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": true,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 2,\n \t\t\t\t\"lastRefreshed\": 1528919583964\n \t\t\t}\n \t\t},\n \t\t\"model00000163faae1960_00000000\": {\n \t\t\t\"id\": \"model00000163faae1960_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model00000163fa699ad8_00000001\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\t\"id\": \"model00000163faae52f6_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_TONE.TONE_NAME\",\n \t\t\t\t\t\t\t\"itemLabel\": \"\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model00000163faae5f38_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_TONE.SCORE\",\n \t\t\t\t\t\t\t\"itemLabel\": \"SCORE\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model00000163faae7460_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_TONE.USER_\",\n \t\t\t\t\t\t\t\"itemLabel\": \"USER\"\n \t\t\t\t\t\t}\n \t\t\t\t\t],\n \t\t\t\t\t\"id\": \"model00000163faae52f4_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\t\"name\": \"categories\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163faae7460_00000000\"],\n \t\t\t\t\t\t\"dataItemSettings\": [],\n \t\t\t\t\t\t\"caption\": \"Bars\",\n \t\t\t\t\t\t\"id\": \"categories\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"name\": \"values\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163faae5f38_00000000\"],\n \t\t\t\t\t\t\"caption\": \"Length\",\n \t\t\t\t\t\t\"id\": \"values\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"name\": \"color\",\n \t\t\t\t\t\t\"dataItems\": [\"model00000163faae52f6_00000000\"],\n \t\t\t\t\t\t\"caption\": \"Color\",\n \t\t\t\t\t\t\"id\": \"color\"\n \t\t\t\t\t}\n \t\t\t\t]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"com.ibm.vis.rave2bundlestackedbar\",\n \t\t\t\"name\": \"Tone\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\"id\": \"CALL_TONE.USER_\",\n \t\t\t\t\"columnId\": \"CALL_TONE.USER_\",\n \t\t\t\t\"values\": [{\n \t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\"u\": \"CALL_TONE.USER_->[\" + yourPhone + \"]\"\n \t\t\t\t}],\n \t\t\t\t\"excludedValues\": [],\n \t\t\t\t\"operator\": \"in\",\n \t\t\t\t\"type\": null\n \t\t\t}],\n \t\t\t\"showTitle\": true,\n \t\t\t\"properties\": [{\n \t\t\t\t\t\"id\": \"stacked.percent\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"itemAxis.labels.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"valueAxis.labels.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"gridLines.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"titles.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"valueLabels.visible\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"maintainAxisScales\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"widget.legend.position\",\n \t\t\t\t\t\"value\": \"top\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"widget.legend.display\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": true,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 2,\n \t\t\t\t\"lastRefreshed\": 1528919405202\n \t\t\t}\n \t\t},\n \t\t\"model00000164008cb5ce_00000000\": {\n \t\t\t\"id\": \"model00000164008cb5ce_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model0000016400833ab8_00000000\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\t\"id\": \"model00000164008d766c_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.COUNTRY\",\n \t\t\t\t\t\t\t\"itemLabel\": \"COUNTRY\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model00000164008ee86a_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.STATE_\",\n \t\t\t\t\t\t\t\"itemLabel\": \"STATE\"\n \t\t\t\t\t\t}\n \t\t\t\t\t],\n \t\t\t\t\t\"id\": \"model00000164008ccfda_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\"name\": \"locations\",\n \t\t\t\t\t\"dataItems\": [\"model00000164008d766c_00000000\", \"model00000164008ee86a_00000000\"],\n \t\t\t\t\t\"dataItemSettings\": [],\n \t\t\t\t\t\"caption\": \"Locations\",\n \t\t\t\t\t\"id\": \"locations\",\n \t\t\t\t\t\"layerId\": \"data.region\"\n \t\t\t\t}],\n \t\t\t\t\"layers\": [{\n \t\t\t\t\t\"type\": \"data.region\",\n \t\t\t\t\t\"id\": \"data.region\",\n \t\t\t\t\t\"dataViewId\": \"model00000164008ccfda_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"com.ibm.vis.rave2bundletiledmap\",\n \t\t\t\"name\": \"Location\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\"id\": \"USERS.PHONE\",\n \t\t\t\t\"columnId\": \"USERS.PHONE\",\n \t\t\t\t\"values\": [{\n \t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\"u\": \"USERS.PHONE->[\" + yourPhone + \"]\"\n \t\t\t\t}],\n \t\t\t\t\"excludedValues\": [],\n \t\t\t\t\"operator\": \"in\",\n \t\t\t\t\"type\": null\n \t\t\t}],\n \t\t\t\"showTitle\": true,\n \t\t\t\"properties\": [{\n \t\t\t\t\t\"id\": \"mapStyle\",\n \t\t\t\t\t\"value\": \"bright\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"autoZoom\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"maintainAxisScales\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"Mapbox.secretToken\",\n \t\t\t\t\t\"value\": \"sk.eyJ1IjoiaWJtcmF2ZSIsImEiOiJjaXlrdjl6dzUwMDJlMnlwaXV3bTJtdGQ4In0.Ek4ZA_uWjmdwh9AzD-UWyg\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"Mapbox.accountName\",\n \t\t\t\t\t\"value\": \"ibmrave\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"Mapbox.token\",\n \t\t\t\t\t\"value\": \"pk.eyJ1IjoiaWJtcmF2ZSIsImEiOiJjaXRvZHFzdmYwM20zMnpzYmFxeHR4bTQyIn0.7rttWKsr9b1tVXpo0ZcWFw\"\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": false,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 5,\n \t\t\t\t\"lastRefreshed\": 1529019417334\n \t\t\t}\n \t\t},\n \t\t\"model000001640098ef5a_00000000\": {\n \t\t\t\"id\": \"model000001640098ef5a_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model0000016400368196_00000001\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\t\"id\": \"model000001640099193c_00000001\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_UPSELL.PRODUCT\",\n \t\t\t\t\t\t\t\"itemLabel\": \"PRODUCT\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016400991f5a_00000001\",\n \t\t\t\t\t\t\t\"itemId\": \"CALL_UPSELL.PROBABILITY\",\n \t\t\t\t\t\t\t\"itemLabel\": \"PROBABILITY\"\n \t\t\t\t\t\t}\n \t\t\t\t\t],\n \t\t\t\t\t\"id\": \"model000001640099193c_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\t\"name\": \"categories\",\n \t\t\t\t\t\t\"dataItems\": [\"model000001640099193c_00000001\"],\n \t\t\t\t\t\t\"dataItemSettings\": [],\n \t\t\t\t\t\t\"caption\": \"Bubbles\",\n \t\t\t\t\t\t\"id\": \"categories\"\n \t\t\t\t\t},\n \t\t\t\t\t{\n \t\t\t\t\t\t\"name\": \"size\",\n \t\t\t\t\t\t\"dataItems\": [\"model0000016400991f5a_00000001\"],\n \t\t\t\t\t\t\"caption\": \"Size\",\n \t\t\t\t\t\t\"id\": \"size\"\n \t\t\t\t\t}\n \t\t\t\t]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"com.ibm.vis.rave2bundlepackedbubble\",\n \t\t\t\"name\": \"Upsell\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\"id\": \"CALL_UPSELL.USER_\",\n \t\t\t\t\"columnId\": \"CALL_UPSELL.USER_\",\n \t\t\t\t\"values\": [{\n \t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\"u\": \"CALL_UPSELL.USER_->[\" + yourPhone + \"]\"\n \t\t\t\t}],\n \t\t\t\t\"excludedValues\": [],\n \t\t\t\t\"operator\": \"in\",\n \t\t\t\t\"type\": null\n \t\t\t}],\n \t\t\t\"showTitle\": true,\n \t\t\t\"properties\": [{\n \t\t\t\t\t\"id\": \"labels.visible\",\n \t\t\t\t\t\"value\": true\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"labels.format\",\n \t\t\t\t\t\"value\": \"Item\"\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"widget.legend.display\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": true,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 5,\n \t\t\t\t\"lastRefreshed\": 1529019906012\n \t\t\t}\n \t\t},\n \t\t\"model00000164009d22c0_00000000\": {\n \t\t\t\"id\": \"model00000164009d22c0_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model00000164009cf3ae_00000002\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\"id\": \"model00000164009d7de4_00000000\",\n \t\t\t\t\t\t\"itemId\": \"CALL_RISK.RISK\",\n \t\t\t\t\t\t\"itemLabel\": \"RISK\"\n \t\t\t\t\t}],\n \t\t\t\t\t\"id\": \"model00000164009d7de2_00000001\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\"name\": \"values\",\n \t\t\t\t\t\"dataItems\": [\"model00000164009d7de4_00000000\"],\n \t\t\t\t\t\"dataItemSettings\": [{\n \t\t\t\t\t\t\"graphic\": {\n \t\t\t\t\t\t\t\"content\": \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" version=\\\"1.1\\\"  class=\\\"staticContent\\\" height=\\\"100%\\\" width=\\\"100%\\\" preserveAspectRatio=\\\"none\\\"  viewBox=\\\"0 0 32 32\\\"><g xmlns=\\\"http://www.w3.org/2000/svg\\\" vector-effect=\\\"non-scaling-stroke\\\"><path d=\\\"M28.4,13.7c0-6.8-5.6-12.4-12.4-12.4S3.6,6.8,3.6,13.7c0,3.8,1.7,7.1,4.3,9.4l0,0.2V29c0,0,3.7,2,8.1,2 s8.1-2,8.1-2v-5.6l0-0.2C26.7,20.8,28.4,17.5,28.4,13.7z M23.2,22.6v0.2V28c0,0-0.8,0.5-2.1,1l0-2.9h-1.6l0,3.3 c-0.8,0.2-1.7,0.4-2.7,0.4l0-3.8h-1.6l0,3.8c-1-0.1-1.9-0.2-2.7-0.4l0-3.3h-1.6l0,2.8c-1.2-0.5-2-0.9-2-0.9v-5.2v-0.2 c-2.4-2.1-4.4-5.2-4.4-8.7C4.5,7.5,9.6,2.4,16,2.4s11.5,5.1,11.5,11.5C27.5,17.4,25.6,20.5,23.2,22.6z\\\" vector-effect=\\\"non-scaling-stroke\\\"/><path d=\\\"M16.1,17.7c-0.9,0-3,3.9-2.3,4.7c0.7,0.8,1.8-0.3,2.3-0.3c0.5,0,1.4,1,2.2,0.3C18.9,21.7,17,17.7,16.1,17.7 z\\\" vector-effect=\\\"non-scaling-stroke\\\"/><circle cx=\\\"11.6\\\" cy=\\\"13.5\\\" r=\\\"3\\\" vector-effect=\\\"non-scaling-stroke\\\"/><circle cx=\\\"20.4\\\" cy=\\\"13.5\\\" r=\\\"3\\\" vector-effect=\\\"non-scaling-stroke\\\"/></g></svg>\",\n \t\t\t\t\t\t\t\"fillColor\": \"color8\",\n \t\t\t\t\t\t\t\"borderColor\": \"transparent\",\n \t\t\t\t\t\t\t\"currentScaleOption\": 1\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"shapeDropEnabled\": true\n \t\t\t\t\t}],\n \t\t\t\t\t\"caption\": \"Value\",\n \t\t\t\t\t\"id\": \"values\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"summary\",\n \t\t\t\"name\": \"Risk\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\"id\": \"CALL_RISK.USER_\",\n \t\t\t\t\"columnId\": \"CALL_RISK.USER_\",\n \t\t\t\t\"values\": [{\n \t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\"u\": \"CALL_RISK.USER_->[\" + yourPhone + \"]\"\n \t\t\t\t}],\n \t\t\t\t\"excludedValues\": [],\n \t\t\t\t\"operator\": \"in\",\n \t\t\t\t\"type\": null\n \t\t\t}],\n \t\t\t\"showTitle\": true,\n \t\t\t\"properties\": [{\n \t\t\t\t\t\"id\": \"showItemLabel\",\n \t\t\t\t\t\"value\": false\n \t\t\t\t},\n \t\t\t\t{\n \t\t\t\t\t\"id\": \"fillDirection\",\n \t\t\t\t\t\"value\": \"BottomToTop\"\n \t\t\t\t}\n \t\t\t],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": true,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 5,\n \t\t\t\t\"lastRefreshed\": 1529019905002\n \t\t\t}\n \t\t},\n \t\t\"model00000164009fd2d2_00000000\": {\n \t\t\t\"id\": \"model00000164009fd2d2_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model0000016400833ab8_00000000\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\"id\": \"model0000016400adc6dc_00000000\",\n \t\t\t\t\t\t\"itemId\": \"Calculation_name_2\",\n \t\t\t\t\t\t\"itemLabel\": \"uvalue\"\n \t\t\t\t\t}],\n \t\t\t\t\t\"id\": \"model00000164009ffcc0_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\"name\": \"values\",\n \t\t\t\t\t\"dataItems\": [\"model0000016400adc6dc_00000000\"],\n \t\t\t\t\t\"dataItemSettings\": [{\n \t\t\t\t\t\t\"graphic\": {\n \t\t\t\t\t\t\t\"content\": \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" version=\\\"1.1\\\"  class=\\\"staticContent\\\" height=\\\"100%\\\" width=\\\"100%\\\" preserveAspectRatio=\\\"none\\\"  viewBox=\\\"0 0 32 32\\\"><g xmlns=\\\"http://www.w3.org/2000/svg\\\" vector-effect=\\\"non-scaling-stroke\\\"><path d=\\\"M0,7.8v18.4h32V7.8H0z M30,24.3H2V9.7h28V24.3z\\\" vector-effect=\\\"non-scaling-stroke\\\"/><path d=\\\"M3,10.7v12.6h26V10.7H3z M18.1,20c-0.4,0.5-1.3,0.7-2.1,0.8v1.1h-1v-1.1c-1.4-0.1-2.3-0.8-2.6-2l1.6-0.4 c0.2,0.7,0.7,1,1.5,1c0.4,0,0.7-0.1,0.9-0.2c0.2-0.1,0.3-0.3,0.3-0.6c0-0.2-0.1-0.4-0.3-0.5c-0.2-0.1-0.5-0.2-1-0.3 c-1.1-0.2-1.8-0.5-2.1-0.9c-0.3-0.4-0.5-0.8-0.5-1.4s0.2-1.1,0.6-1.6c0.4-0.4,0.9-0.7,1.6-0.8v-0.9h1v0.9c1.2,0.1,2,0.7,2.4,1.7 l-1.5,0.5c-0.2-0.6-0.6-0.9-1.3-0.9c-0.7,0-1,0.2-1,0.7c0,0.2,0.1,0.3,0.2,0.5c0.1,0.2,0.4,0.2,0.9,0.3c0.8,0.2,1.3,0.3,1.7,0.5 c0.4,0.2,0.7,0.4,0.9,0.8c0.2,0.4,0.4,0.7,0.4,1.2C18.7,19,18.5,19.5,18.1,20z\\\" vector-effect=\\\"non-scaling-stroke\\\"/></g></svg>\",\n \t\t\t\t\t\t\t\"fillColor\": \"color8\",\n \t\t\t\t\t\t\t\"borderColor\": \"transparent\",\n \t\t\t\t\t\t\t\"currentScaleOption\": 1\n \t\t\t\t\t\t},\n \t\t\t\t\t\t\"shapeDropEnabled\": true\n \t\t\t\t\t}],\n \t\t\t\t\t\"caption\": \"Value\",\n \t\t\t\t\t\"id\": \"values\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"summary\",\n \t\t\t\"name\": \"Value\",\n \t\t\t\"localFilters\": [],\n \t\t\t\"showTitle\": true,\n \t\t\t\"properties\": [{\n \t\t\t\t\"id\": \"showItemLabel\",\n \t\t\t\t\"value\": false\n \t\t\t}]\n \t\t},\n \t\t\"model0000016401b3c240_00000000\": {\n \t\t\t\"id\": \"model0000016401b3c240_00000000\",\n \t\t\t\"data\": {\n \t\t\t\t\"dataViews\": [{\n \t\t\t\t\t\"modelRef\": \"model0000016400833ab8_00000000\",\n \t\t\t\t\t\"dataItems\": [{\n \t\t\t\t\t\t\t\"id\": \"model0000016401b433ca_00000001\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.FNAME\",\n \t\t\t\t\t\t\t\"itemLabel\": \"First\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016401b44060_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.LNAME\",\n \t\t\t\t\t\t\t\"itemLabel\": \"Last\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016401c1ab34_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.ADDRESS\",\n \t\t\t\t\t\t\t\"itemLabel\": \"Address\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016401c1f772_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.CITY\",\n \t\t\t\t\t\t\t\"itemLabel\": \"City\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016401c2b046_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.MONTHLY_PAYMENT\",\n \t\t\t\t\t\t\t\"itemLabel\": \"Payment\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016401c31d82_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.AGE\",\n \t\t\t\t\t\t\t\"itemLabel\": \"Age\"\n \t\t\t\t\t\t},\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\t\"id\": \"model0000016401c33a5e_00000000\",\n \t\t\t\t\t\t\t\"itemId\": \"USERS.GENDER\",\n \t\t\t\t\t\t\t\"itemLabel\": \"Sex\"\n \t\t\t\t\t\t}\n \t\t\t\t\t],\n \t\t\t\t\t\"id\": \"model0000016401b433ca_00000000\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"visTypeLocked\": true,\n \t\t\t\"slotmapping\": {\n \t\t\t\t\"slots\": [{\n \t\t\t\t\t\"name\": \"grid_cols\",\n \t\t\t\t\t\"dataItems\": [\"model0000016401b433ca_00000001\", \"model0000016401b44060_00000000\", \"model0000016401c31d82_00000000\", \"model0000016401c33a5e_00000000\", \"model0000016401c1ab34_00000000\", \"model0000016401c1f772_00000000\", \"model0000016401c29cbc_00000000\", \"model0000016401c2b046_00000000\"],\n \t\t\t\t\t\"caption\": \"Columns\",\n \t\t\t\t\t\"id\": \"grid_cols\"\n \t\t\t\t}]\n \t\t\t},\n \t\t\t\"type\": \"live\",\n \t\t\t\"visId\": \"JQGrid\",\n \t\t\t\"name\": \"\",\n \t\t\t\"localFilters\": [{\n \t\t\t\t\"id\": \"USERS.PHONE\",\n \t\t\t\t\"columnId\": \"USERS.PHONE\",\n \t\t\t\t\"values\": [{\n \t\t\t\t\t\"d\": yourPhone,\n \t\t\t\t\t\"u\": \"USERS.PHONE->[\" + yourPhone + \"]\"\n \t\t\t\t}],\n \t\t\t\t\"excludedValues\": [],\n \t\t\t\t\"operator\": \"in\",\n \t\t\t\t\"type\": null\n \t\t\t}],\n \t\t\t\"properties\": [{\n \t\t\t\t\"id\": \"hideSummaries\",\n \t\t\t\t\"value\": true\n \t\t\t}],\n \t\t\t\"queryRefresh\": {\n \t\t\t\t\"autoRefresh\": false,\n \t\t\t\t\"unit\": \"seconds\",\n \t\t\t\t\"value\": 5\n \t\t\t}\n \t\t},\n         \"model00000164619c2635_00000000\": {\n\t\t\t\"id\": \"model00000164619c2635_00000000\",\n\t\t\t\"type\": \"webpage\",\n\t\t\t\"visTypeLocked\": true,\n\t\t\t\"name\": \"\",\n\t\t\t\"url\": \"https://customerconcierge.mybluemix.net/discovery?yourPhone=\" + yourPhone\n\t\t}\n \t}\n };\n        \n","output":"str","x":320,"y":400,"wires":[["493233cf.e4934c"]]},{"id":"4f701a9f.b67f6c","type":"http in","z":"8246e271.253b4","name":"","url":"/cognos","method":"get","upload":false,"swaggerDoc":"","x":170,"y":400,"wires":[["3fe4da4b.49ca5e"]]},{"id":"493233cf.e4934c","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/javascript","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":400,"wires":[["d2fb143e.e7974"]]},{"id":"2b6f48a4.5e4e6","type":"watson-tone-analyzer-v3","z":"45bfaeea.5a7458","name":"Tone Analyzer","tones":"emotion","sentences":"true","contentType":"false","tone-method":"generalTone","interface-version":"2016-05-19","inputlang":"en","default-endpoint":true,"service-endpoint":"https://gateway.watsonplatform.net/tone-analyzer/api","x":400,"y":671,"wires":[["15617e91.caa0d9"]]},{"id":"caa7552d.db88b","type":"function","z":"45bfaeea.5a7458","name":"pre nlc","func":"\n//store payload before calling watson api\nmsg.prewatsonpayload = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":711,"wires":[["dbc60769.943068"]]},{"id":"dbc60769.943068","type":"watson-natural-language-classifier","z":"45bfaeea.5a7458","name":"NLC","mode":"classify","language":"en","classifier":"ab2966x340-nlc-197","collections-off":true,"default-endpoint":true,"service-endpoint":"https://gateway.watsonplatform.net/natural-language-classifier/api","x":370,"y":711,"wires":[["5bb38671.b40d6"]]},{"id":"683d8f8c.f27e9","type":"function","z":"45bfaeea.5a7458","name":"pre tone","func":"\n//store payload before calling watson api\nmsg.prewatsonpayload = msg.payload;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":671,"wires":[["2b6f48a4.5e4e6"]]},{"id":"da41e5e4.275038","type":"function","z":"45bfaeea.5a7458","name":"process class","func":"for (x=0; x< msg.classes.length; x++){\n    t = {};\n    t.payload =\n    {\n        USER : msg.user,\n        CLASS_NAME: msg.classes[x].class_name,\n        CONFIDENCE : msg.classes[x].confidence\n    }\n    node.send(t)\n}\n","outputs":1,"noerr":0,"x":820,"y":711,"wires":[["93d818a7.ada34"]]},{"id":"6b34a7d0.3a2ed8","type":"link in","z":"45bfaeea.5a7458","name":"Tone and Class","links":["2498bfbf.def71","8899dcc9.ab69f"],"x":115,"y":671,"wires":[["683d8f8c.f27e9","caa7552d.db88b","3c740200.1486e6"]]},{"id":"93d818a7.ada34","type":"dashDB out","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","table":"CALL_CLASSIFICATION","name":"Classification","x":990,"y":711,"wires":[]},{"id":"51c0154f.f0399c","type":"function","z":"45bfaeea.5a7458","name":"process tone","func":"\nfor (x=0; x< msg.tones.length; x++){\n    t = {};\n    t.payload =\n    {\n        USER : msg.user,\n        TONE_NAME: msg.tones[x].tone_name,\n        SCORE : msg.tones[x].score\n    }\n    node.send(t)\n}\n","outputs":1,"noerr":0,"x":830,"y":671,"wires":[["af9dbfe.b7d91c"]]},{"id":"af9dbfe.b7d91c","type":"dashDB out","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","table":"CALL_TONE","name":"Tone","x":970,"y":671,"wires":[]},{"id":"20a1d796.12689","type":"dashDB in","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","query":"truncate table call_tone immediate;","params":"","name":"Truncate","x":680,"y":671,"wires":[["51c0154f.f0399c"]]},{"id":"15617e91.caa0d9","type":"function","z":"45bfaeea.5a7458","name":"","func":"msg.tones = msg.response.document_tone.tone_categories[0].tones;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":671,"wires":[["20a1d796.12689"]]},{"id":"38939477.1d895c","type":"dashDB in","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","query":"truncate table CALL_CLASSIFICATION immediate;","params":"","name":"Truncate","x":660,"y":711,"wires":[["da41e5e4.275038"]]},{"id":"5bb38671.b40d6","type":"function","z":"45bfaeea.5a7458","name":"","func":"msg.classes = msg.payload.classes;\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":711,"wires":[["38939477.1d895c"]]},{"id":"dec8e5b7.02bf3","type":"wml","z":"45bfaeea.5a7458","name":"","connection":"43d08a57.f16084","wml-mode":"runPrediction","model":"0e2d2ade-6084-44b2-9233-7b85c330da15","deployment":"e8ae862e-9f49-4569-b4e8-db94a6e9e6e9","modelhidden":"0e2d2ade-6084-44b2-9233-7b85c330da15","deploymenthidden":"","x":350,"y":751,"wires":[["7dc75d9d.3c4e7c"]]},{"id":"3c740200.1486e6","type":"function","z":"45bfaeea.5a7458","name":"","func":"msg.GENDER = \"m\"\nmsg.AGE = 43\nmsg.STATE = \"MD\"\nmsg.MONTHLY_PAYMENT = 67\nmsg.TOTAL_PAYMENTS = 3004\n\nmsg.payload = {\"fields\":[\"GENDER\", \"AGE\", \"STATE\", \"MONTHLY_PAYMENT\", \"TOTAL_PAYMENTS\"], \"values\":[[msg.GENDER, msg.AGE, msg.STATE, msg.MONTHLY_PAYMENT, msg.TOTAL_PAYMENTS]]};\n\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":751,"wires":[["dec8e5b7.02bf3"]]},{"id":"faeee258.ae22","type":"function","z":"45bfaeea.5a7458","name":"process tone","func":"\nfor (x=0; x< msg.pred.values[0][msg.pred.fields.indexOf(\"probability\")].length; x++){\n    t = {};\n    t.payload =\n    {\n        USER : msg.user,\n        PRODUCT: msg.pred.values[0][msg.pred.fields.indexOf(\"nodeADP_classes\")][x],\n        PROBABILITY : msg.pred.values[0][msg.pred.fields.indexOf(\"probability\")][x]\n    }\n    node.send(t)\n}\n","outputs":1,"noerr":0,"x":750,"y":751,"wires":[["c0cef35b.25c978"]]},{"id":"c0cef35b.25c978","type":"dashDB out","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","table":"CALL_UPSELL","name":"Upsell","x":890,"y":751,"wires":[]},{"id":"192d9780.1dc239","type":"dashDB in","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","query":"truncate table call_upsell immediate;","params":"","name":"Truncate","x":600,"y":751,"wires":[["faeee258.ae22"]]},{"id":"7dc75d9d.3c4e7c","type":"function","z":"45bfaeea.5a7458","name":"","func":"msg.pred = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":751,"wires":[["192d9780.1dc239"]]},{"id":"a447f7e5.b36af","type":"http response","z":"45bfaeea.5a7458","name":"","statusCode":"","headers":{},"x":590,"y":140,"wires":[]},{"id":"f75f16df.ec3428","type":"http in","z":"45bfaeea.5a7458","name":"","url":"/speakerCallback","method":"post","upload":false,"swaggerDoc":"","x":140,"y":100,"wires":[["5f302fb6.f88e78"]]},{"id":"5f302fb6.f88e78","type":"function","z":"45bfaeea.5a7458","name":"","func":"var speaker = flow.get(\"speaker\");\n\nvar conversation = msg.payload.FriendlyName;\nvar call = msg.payload.CallSid;\nvar cstatus = msg.payload.StatusCallbackEvent;\n\nif (typeof(speaker[conversation]) == \"undefined\"){\n    speaker[conversation] = {};\n}\nif (typeof(speaker[conversation][call]) == \"undefined\"){\n    speaker[conversation][call] = {};\n}\n\nspeaker[conversation][call] = cstatus;\nflow.set(\"speaker\", speaker);","outputs":1,"noerr":0,"x":370,"y":100,"wires":[["6cd183bc.23399c"]]},{"id":"f6f63353.35e8c8","type":"template","z":"45bfaeea.5a7458","name":"Agent","field":"chat","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<li class=\"left clearfix\">\n    <span class=\"chat-img pull-left\">\n        <img src=\"http://placehold.it/50/55C1E7/fff&text=A\" alt=\"Agent\" class=\"img-circle\" />\n    </span>\n            <div class=\"chat-body clearfix\">\n                <div class=\"header\">\n                    <strong class=\"primary-font\">Agent</strong> <small class=\"pull-right text-muted\">\n                    \n                </div>\n                <p>{{payload}}</p>\n            </div>\n</li>","output":"str","x":870,"y":180,"wires":[["9370be58.996e1"]]},{"id":"7c6826e9.1b1d6","type":"function","z":"45bfaeea.5a7458","name":"Assemble","func":"msg.payload = {\"output\":{\"text\":[\"\"]},\"context\":{\"conversation_id\":msg.user}}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":460,"y":180,"wires":[["9ff535fe.304508"]]},{"id":"2c99eb32.b9eabc","type":"function","z":"45bfaeea.5a7458","name":"Mute while Agent","func":"var agents = flow.get(\"agents\");\nif (agents[msg.user] === null){\n    return msg;\n}\n","outputs":1,"noerr":0,"x":890,"y":380,"wires":[["b9afe0d5.5a295","c402f685.779ff8"]]},{"id":"45196eaf.44bbf8","type":"function","z":"45bfaeea.5a7458","name":"Speaker","func":"var agents = flow.get('agents');\nvar speaker = flow.get(\"speaker\");\n\n\nif (agents[msg.user] !== null){\n    if (typeof(speaker[msg.user][agents[msg.user]]) !== \"undefined\"){\n            if (speaker[msg.user][agents[msg.user]] == \"participant-speech-start\"){\n               return [msg,null]; //agent talking\n            }\n    }\n}\nreturn [null, msg]; //user talking\n","outputs":2,"noerr":0,"x":480,"y":220,"wires":[["f6f63353.35e8c8"],["23fdc12d.eb019e","321402cc.35178e","8899dcc9.ab69f"]]},{"id":"464997b.5032a68","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/**\n * @license Licensed Materials - Property of IBM\n * @copyright IBM Cognos Products: BI Cloud (C) Copyright IBM Corp. 2017, 2018\n * US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.\n *\n * @file <strong>{@link CognosApi}</strong> class provides an client API framework for developing applications using IBM Cognos Analytics components <i>as a service</i>.\n * <strong>{@link CognosApi}</strong> class is the root level API. Once the <strong>{@link CognosApi}</strong> is <code>initialized</code>,\n * it provides an entry point to all service APIs where developers can have direct access to rich features of IBM Cognos Analytics components.<br>\n * Multiple instances of the <strong>{@link CognosApi}</strong> class can be instantiated if the client application wishes to access more than one services\n * (or the same service in multiple instances).<br>\n * <br>\n * As a prerequisite, <strong>{@link CognosApi}</strong> requires a <strong>Promise</strong> library.\n * Although most modern (ECMAScript 6 compatible) browsers do support <strong>Promise</strong>,\n * It is recommended to load a <strong>Promise</strong> library (ie. Bluebird) to extend the compatibility of the application.\n * <br><br>\n * @example\n * // Create an instance of the CognosApi by providing the IBM Cognos Analytics root URL\n * // and the DOM node of the container DIV\n * const cognosApi = new CognosApi({\n * \tcognosRootURL: 'http://localhost/bi/',\n * \tnode: document.getElementById('containerDivId')\n * });\n *\n * // initialize the CognosApi in order to obtain the service APIs\n * cognosApi.initialize().then(() => {\n * \tcognosApi.dashboard.createNew();\n * \t...\n * });\n * ...\n *\n * // Ensure to close API at the end\n * cognosApi.close();\n */\n\n/**\n * Default initialization timeout (30 seconds)\n */\nvar INIT_TIMEOUT = 30000;\n\n/**\n * Constructor of the API client framework\n * @classdesc CognosApi is a client API framework class that builds a robust API for\n * developing applications using CognosAnalytics components as a service.\n * @constructor\n * @param {object} options.cognosRootURL CognosAnalytics root URL\n * @param {object} options.node DOM node that will become the container of the client\n * @param {object} options.sessionCode sessionCode of the obtained session\n * @param {object} options.initTimeout initialization timeout (ms). Default 30000 ms.\n * @class CognosApi\n * @example\n * const cognosApi = new CognosApi({\n * \tcognosRootURL: 'http://localhost/bi/',\n * \tnode: document.getElementById('containerDivId'),\n *\tsessionCode: 'CD1a2b34567b8c901234d5'\n * });\n */\n\nvar CognosApi = function () {\n\tfunction CognosApi(options) {\n\t\t_classCallCheck(this, CognosApi);\n\n\t\tif (!options || !options.node || !options.cognosRootURL) {\n\t\t\tthrow new Error('Invalid options parameter passed into the constructor. Must provide both options.node and options.cognosRootURL in the options parameter.');\n\t\t}\n\n\t\tthis._node = options.node;\n\t\tthis._cognosURL = options.cognosRootURL;\n\t\tthis._testURL = options.testURL;\n\t\tthis._sessionCode = options.sessionCode;\n\t\tthis._initTimeout = options.initTimeout || INIT_TIMEOUT;\n\n\t\tthis._apiKey = CognosApi._createUID('capi');\n\t\tthis._pendingRequests = {};\n\t\tthis._eventCallbacks = {};\n\t\tthis._eventReverseLookup = {};\n\n\t\t// regular expression validate the incoming message header\n\t\tthis._message_regex = new RegExp('#capi#(.+)#' + this._apiKey + '#(.*)$', 'g');\n\n\t\t/**\n   * Allows the caller to update the module definitions inside the dashboard specification\n   * @memberof CognosApi\n   * @function CognosApi#updateModuleDefinitions\n   * @param {String} dashboardSpec The dashboard specification\n   * @param {Function} callback A callback method which will be called with an array of module IDs.  This callback should return an array of objects containing the module ID (id) and the new module definition (module).\n   * @return {Promise} Promise that gets resolved with the updated dashboard specification\n   * @example\n   * const cognosApi = new CognosApi({\n   * \tcognosRootURL: 'http://localhost/bi/',\n   * \tnode: document.getElementById('containerDivId'),\n   *\tsessionCode: 'CD1a2b34567b8c901234d5'\n   * });\n   *\n   * cognosApi.initialize().then(() => {\n   * \tconsole.log(cognosApi.dashboard);\n   * });\n   *\n   * cognosApi.updateModuleDefinitions(oldDashboardSpec, (moduleIds) => {\n   * \t// Implement the callback that returns an array of the new module definitions.\n   * \t// The array of module definitions corresponds to the array of moduleIds\n   * \treturn Promise.resolve(newModules);\n   * }).then((newDashboardSpec) => {\n   *\tconsole.log(newDashboardSpec);\n   * });\n   */\n\t\tthis.updateModuleDefinitions = CognosApi._updateModuleDefinitions.bind(this);\n\t}\n\n\t/**\n  * Initializes the CognosApi client.\n  * @memberof CognosApi\n  * @function CognosApi#initialize\n  * @return {Promise} Promise that gets resolved with a Api instance is constructed with available APIs\n  * @example\n  * const cognosApi = new CognosApi({\n  * \tcognosRootURL: 'http://localhost/bi/',\n  * \tnode: document.getElementById('containerDivId'),\n  *\tsessionCode: 'CD1a2b34567b8c901234d5',\n  * \tinitTimeout: 5000\n  * });\n  * cognosApi.initialize().then(() => {\n  * \tconsole.log(cognosApi.dashboard);\n  * }, (error) => {\n  * \t// Initialization took more than 5 seconds\n  * \tconsole.log(error);\n  * });\n  */\n\n\n\t_createClass(CognosApi, [{\n\t\tkey: 'initialize',\n\t\tvalue: function initialize() {\n\t\t\tvar _this = this;\n\n\t\t\tif (!this._readyPromise) {\n\t\t\t\tthis._readyPromise = new Promise(function (resolve, reject) {\n\t\t\t\t\t// setup the initialize timeout\n\t\t\t\t\tvar timeout = setTimeout(_this._onInitTimeout.bind(_this, reject), _this._initTimeout);\n\n\t\t\t\t\t// create the API service container\n\t\t\t\t\t_this._initializeContainer();\n\t\t\t\t\t// initialize the API service\n\t\t\t\t\t_this._initializeService().then(function () {\n\t\t\t\t\t\t// clear the init timeout\n\t\t\t\t\t\tclearTimeout(timeout);\n\n\t\t\t\t\t\t// wait for the APIs to be initialized\n\t\t\t\t\t\t_this._sendMessage({\n\t\t\t\t\t\t\tapiId: _this._apiKey,\n\t\t\t\t\t\t\tactionId: CognosApi._createUID(CognosApi.APISERVICE_INIT),\n\t\t\t\t\t\t\tname: CognosApi.APISERVICE_INIT\n\t\t\t\t\t\t}, resolve, reject);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn this._readyPromise;\n\t\t}\n\n\t\t/**\n   * Attach an {@link CognosApi#EVENTS event} handler function for the root CognosApi\n   * @memberof CognosApi\n   * @function CognosApi#on\n   * @param {string} eventName - name of the event\n   * @callback cb - event handler callback\n   */\n\n\t}, {\n\t\tkey: 'on',\n\t\tvalue: function on(eventName, cb) {\n\t\t\tif (!this._eventReverseLookup[cb]) {\n\t\t\t\tthis._sendMessage({\n\t\t\t\t\tapiId: this._apiKey,\n\t\t\t\t\tactionId: CognosApi._createUID(CognosApi.APISERVICE_ON),\n\t\t\t\t\tname: CognosApi.APISERVICE_ON,\n\t\t\t\t\tparameters: Array.prototype.slice.call(arguments)\n\t\t\t\t}, cb);\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Dettach an {@link CognosApi#EVENTS event} handler function for the root CognosApi\n   * @memberof CognosApi\n   * @function CognosApi#on\n   * @param {string} eventName - name of the event\n   * @callback cb - event handler callback\n   */\n\n\t}, {\n\t\tkey: 'off',\n\t\tvalue: function off(eventName, cb) {\n\t\t\tif (this._eventReverseLookup[cb]) {\n\t\t\t\tthis._sendMessage({\n\t\t\t\t\tapiId: this._apiKey,\n\t\t\t\t\tactionId: this._eventReverseLookup[cb],\n\t\t\t\t\tname: CognosApi.APISERVICE_OFF,\n\t\t\t\t\tparameters: Array.prototype.slice.call(arguments)\n\t\t\t\t}, cb);\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * initialization timeout handler\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_onInitTimeout',\n\t\tvalue: function _onInitTimeout(reject) {\n\t\t\tthis._cleanupContainer();\n\t\t\treject(new Error('Initialization timeout. ' + this._initTimeout + 'ms'));\n\t\t}\n\n\t\t/**\n   * Initialize the CAPI service container\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_initializeContainer',\n\t\tvalue: function _initializeContainer() {\n\t\t\tvar container = document.createElement('iframe');\n\n\t\t\tcontainer.src = this._buildSourceUrl();\n\t\t\tcontainer.setAttribute('class', CognosApi.APISERVICE_CLASS);\n\t\t\tcontainer.setAttribute('style', 'height:100%; width:100%;');\n\t\t\tcontainer.setAttribute('frameBorder', '0');\n\n\t\t\t// append the container to the root node\n\t\t\tthis._node.innerHTML = '';\n\t\t\tthis._node.appendChild(container);\n\n\t\t\t// keep the iframe contentWindow as the messaging target\n\t\t\tthis._target = container.contentWindow;\n\t\t\tthis._targetOrigin = (/(https*:\\/\\/[^\\/]+)/.exec(this._cognosURL) || [window.location.origin])[0];\n\t\t}\n\n\t\t/**\n   * Closes the CognosApi client.\n   * @memberof CognosApi\n   * @function CognosApi#close\n   * @return {Promise} Promise that gets resolved with a Api instance is successfully closed\n   * @example\n   * const cognosApi = new CognosApi({\n   * \tcognosRootURL: 'http://localhost/bi/',\n   * \tnode: document.getElementById('containerDivId'),\n   *\tsessionCode: 'CD1a2b34567b8c901234d5'\n   * });\n   * ...\n   * cognosApi.close();\n   */\n\n\t}, {\n\t\tkey: 'close',\n\t\tvalue: function close() {\n\t\t\tvar _this2 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this2._destroyService().then(function (obj) {\n\t\t\t\t\t// remove all injected apis\n\t\t\t\t\t_this2._cleanupApiService();\n\t\t\t\t\t// clean up the container node\n\t\t\t\t\t_this2._cleanupContainer();\n\t\t\t\t\tresolve(obj);\n\t\t\t\t}, function (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: '_buildSourceUrl',\n\t\tvalue: function _buildSourceUrl() {\n\t\t\tif (this._testURL) {\n\t\t\t\treturn this._testURL;\n\t\t\t} else {\n\t\t\t\tvar root = this._cognosURL + (this._cognosURL.indexOf('?') === -1 ? '?' : '&');\n\t\t\t\tvar params = {\n\t\t\t\t\t'perspective': 'postMessageApiLoader',\n\t\t\t\t\t'apiKey': this._apiKey,\n\t\t\t\t\t'parentOrigin': window.location.origin,\n\t\t\t\t\t'sessionCode': this._sessionCode\n\t\t\t\t};\n\t\t\t\treturn root + Object.keys(params).map(function (k) {\n\t\t\t\t\treturn encodeURIComponent(k) + '=' + encodeURIComponent(params[k]);\n\t\t\t\t}).join('&');\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Clean up the injected apis\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_cleanupApiService',\n\t\tvalue: function _cleanupApiService() {\n\t\t\tvar _this3 = this;\n\n\t\t\t// remove the message handler\n\t\t\tif (this._messageHandler) {\n\t\t\t\twindow.removeEventListener('message', this._messageHandler, false);\n\t\t\t}\n\n\t\t\t// clean up all apis\n\t\t\tObject.keys(this).forEach(function (memberName) {\n\t\t\t\tif (memberName.indexOf('_') !== 0 && _typeof(_this3[memberName]) === 'object' && _this3[memberName].apiId) {\n\t\t\t\t\tdelete _this3[memberName];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._pendingRequests = {};\n\t\t\tthis._eventCallbacks = {};\n\t\t\tthis._eventReverseLookup = {};\n\t\t\tthis._messageHandler = null;\n\t\t\tthis.apiId = null;\n\t\t}\n\n\t\t/**\n   * Clean up the iframe container\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_cleanupContainer',\n\t\tvalue: function _cleanupContainer() {\n\t\t\tif (this._node) {\n\t\t\t\tvar iframes = this._node.getElementsByClassName(CognosApi.APISERVICE_CLASS) || [];\n\t\t\t\tif (iframes.length === 1) {\n\t\t\t\t\tthis._node.removeChild(iframes[0]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._readyPromise = null;\n\t\t\tthis._targetOrigin = null;\n\t\t\tthis._target = null;\n\t\t}\n\n\t\t/**\n   * Wait for the CognosApi service to initialize\n   * @private\n   * @return {Promise} Promise that gets resolved when the CognosApi service initialization is complete\n   */\n\n\t}, {\n\t\tkey: '_initializeService',\n\t\tvalue: function _initializeService() {\n\t\t\tvar _this4 = this;\n\n\t\t\tthis._messageHandler = this._receiveMessage.bind(this);\n\t\t\twindow.addEventListener('message', this._messageHandler, false);\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this4._registerResponseCallbacks(_this4._apiKey, resolve, reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Make a request to destroy the service\n   * @private\n   * @return {Promise} Promise that gets resolved when the service finishes terminate\n   */\n\n\t}, {\n\t\tkey: '_destroyService',\n\t\tvalue: function _destroyService() {\n\t\t\tvar _this5 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this5._sendMessage({\n\t\t\t\t\tapiId: _this5._apiKey,\n\t\t\t\t\tactionId: CognosApi._createUID(CognosApi.APISERVICE_DESTROY),\n\t\t\t\t\tname: CognosApi.APISERVICE_DESTROY\n\t\t\t\t}, resolve, reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Register the Promise callbacks that are created for each postMessage requests\n   * @private\n   * @param {string} identifier that uniquely identifies a single postMessage request\n   * @param {function} callback function to be used when the postMessage response comes back successfully\n   * @param {function} callback function to be used when the postMessage response comes back as a failure\n   */\n\n\t}, {\n\t\tkey: '_registerResponseCallbacks',\n\t\tvalue: function _registerResponseCallbacks(id, success, fail) {\n\t\t\tif (id && success) {\n\t\t\t\tthis._pendingRequests[id] = {\n\t\t\t\t\tsuccess: success,\n\t\t\t\t\tfail: fail\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Invoke the resolve callback for the request that has returned successfully\n   * @private\n   * @param {string} identifier that uniquely identifies a single postMessage request\n   * @param {any} the resolved value\n   */\n\n\t}, {\n\t\tkey: '_resolveResponseCallbacks',\n\t\tvalue: function _resolveResponseCallbacks(id, obj) {\n\t\t\tif (id && this._pendingRequests[id]) {\n\t\t\t\tthis._pendingRequests[id].success(obj);\n\t\t\t\tdelete this._pendingRequests[id];\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Invoke the reject callback for the request that has returned as a failure\n   * @private\n   * @param {string} identifier that uniquely identifies a single postMessage request\n   * @param {object} the error object\n   */\n\n\t}, {\n\t\tkey: '_rejectResponseCallbacks',\n\t\tvalue: function _rejectResponseCallbacks(id, obj) {\n\t\t\tif (id && this._pendingRequests[id]) {\n\t\t\t\tthis._pendingRequests[id].fail(obj);\n\t\t\t\tdelete this._pendingRequests[id];\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Register an event callback\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_registerEventCallbacks',\n\t\tvalue: function _registerEventCallbacks(id, callback) {\n\t\t\tif (id && callback) {\n\t\t\t\tthis._eventCallbacks[id] = callback;\n\t\t\t\tthis._eventReverseLookup[callback] = id;\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Unregister an event callback\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_unregisterEventCallbacks',\n\t\tvalue: function _unregisterEventCallbacks(id, callback) {\n\t\t\tif (id && callback && this._eventReverseLookup[callback] === id) {\n\t\t\t\tdelete this._eventCallbacks[id];\n\t\t\t\tdelete this._eventReverseLookup[callback];\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Handle event by invoking the corresponding callback\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_handleEventCallbacks',\n\t\tvalue: function _handleEventCallbacks(id, obj) {\n\t\t\tif (id && typeof this._eventCallbacks[id] === 'function') {\n\t\t\t\tthis._eventCallbacks[id].call(this._eventCallbacks[id], obj);\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Invoke a postMessage to the target window.\n   * Callbacks are registered which gets invoked when the corresponding response is returned\n   * @private\n   * @param {object} Payload object to be post to the target window\n   * @param {function} Resolve callback function\n   * @param {function} Reject callback function\n   */\n\n\t}, {\n\t\tkey: '_sendMessage',\n\t\tvalue: function _sendMessage(obj, success, fail) {\n\t\t\tif (this._target) {\n\t\t\t\tif (obj.name === 'on') {\n\t\t\t\t\tthis._registerEventCallbacks(obj.actionId, success);\n\t\t\t\t} else if (obj.name === 'off') {\n\t\t\t\t\tthis._unregisterEventCallbacks(obj.actionId, success);\n\t\t\t\t} else {\n\t\t\t\t\tthis._registerResponseCallbacks(obj.actionId, success, fail);\n\t\t\t\t}\n\t\t\t\tthis._target.postMessage(this._createMessage(obj), this._targetOrigin);\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Message event handler to handle messages posted by the inner iframe\n   * @private\n   * @param {object} Event object\n   */\n\n\t}, {\n\t\tkey: '_receiveMessage',\n\t\tvalue: function _receiveMessage(event) {\n\t\t\t// Only accept message from the iframe we know about\n\t\t\tif (event.origin !== this._targetOrigin) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar obj = this._parseMessage(event.data);\n\t\t\tif (obj !== null) {\n\t\t\t\tif (!obj.status || obj.status === 'success') {\n\t\t\t\t\tswitch (obj.type) {\n\t\t\t\t\t\tcase 'ready':\n\t\t\t\t\t\t\tthis._resolveResponseCallbacks(this._apiKey);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'api':\n\t\t\t\t\t\t\t// expand the api response by either injecting to the API to the root or creating an new API object\n\t\t\t\t\t\t\tvar resolvedAPI = obj.actionId.indexOf(CognosApi.APISERVICE_INIT) === 0 ? this : {};\n\t\t\t\t\t\t\tthis._injectAPI(resolvedAPI, obj.payload);\n\t\t\t\t\t\t\tthis._resolveResponseCallbacks(obj.actionId, resolvedAPI);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'event':\n\t\t\t\t\t\t\tthis._handleEventCallbacks(obj.actionId, obj.payload);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// simply resolve with the raw payload\n\t\t\t\t\t\t\tthis._resolveResponseCallbacks(obj.actionId, obj.payload);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._rejectResponseCallbacks(obj.actionId, obj.payload);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n   * Create a message with the CAPI header prepended to the message\n   * @private\n   * @param {object} Payload object\n   */\n\n\t}, {\n\t\tkey: '_createMessage',\n\t\tvalue: function _createMessage(obj) {\n\t\t\treturn CognosApi.APIHEADER + CognosApi.APIHEADER_DELIMITER + this._apiKey + CognosApi.APIHEADER_DELIMITER + JSON.stringify(obj);\n\t\t}\n\n\t\t/**\n   * Parse the response message.\n   * @private\n   * @return Response payload object\n   */\n\n\t}, {\n\t\tkey: '_parseMessage',\n\t\tvalue: function _parseMessage(data) {\n\t\t\tvar result = this._message_regex.exec(data);\n\t\t\tif ((typeof result === 'undefined' ? 'undefined' : _typeof(result)) === 'object' && result !== null) {\n\t\t\t\tthis._message_regex.lastIndex = 0;\n\t\t\t\treturn JSON.parse(result[2]);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n   * Inject the API spec returned by the API service to the client API object\n   * @private\n   * @param {object} client API object\n   * @param {object} API spec that describes an API\n   */\n\n\t}, {\n\t\tkey: '_injectAPI',\n\t\tvalue: function _injectAPI(api, apiSpec) {\n\t\t\tvar _this6 = this;\n\n\t\t\tObject.keys(apiSpec).forEach(function (memberName) {\n\t\t\t\tif (memberName === 'apiId') {\n\t\t\t\t\tapi[memberName] = apiSpec[memberName];\n\t\t\t\t} else if (apiSpec[memberName].apiId) {\n\t\t\t\t\t// new nested API needs to built recursively\n\t\t\t\t\tapi[memberName] = {};\n\t\t\t\t\t_this6._injectAPI(api[memberName], apiSpec[memberName]);\n\t\t\t\t} else {\n\t\t\t\t\tif (apiSpec[memberName].type === 'enum') {\n\t\t\t\t\t\tapi[memberName] = apiSpec[memberName].values;\n\t\t\t\t\t} else if (apiSpec[memberName].type === 'method') {\n\t\t\t\t\t\tapi[memberName] = _this6._getAPIMethod(memberName, apiSpec.apiId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n   * Generate an API proxy method to be injected to the client API object\n   * @private\n   * @param {string} Method name\n   * @param {string} Identifier of the API\n   */\n\n\t}, {\n\t\tkey: '_getAPIMethod',\n\t\tvalue: function _getAPIMethod(methodName, apiId) {\n\t\t\tvar _this7 = this;\n\n\t\t\t// predefined event on/off methods\n\t\t\tif (methodName === 'on') {\n\t\t\t\treturn function () {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar params = Array.prototype.slice.call(args);\n\t\t\t\t\tvar callback = params[1];\n\t\t\t\t\t_this7._sendMessage({\n\t\t\t\t\t\tapiId: apiId,\n\t\t\t\t\t\tactionId: CognosApi._createUID(methodName),\n\t\t\t\t\t\tname: methodName,\n\t\t\t\t\t\tparameters: params\n\t\t\t\t\t}, callback, callback);\n\t\t\t\t};\n\t\t\t} else if (methodName === 'off') {\n\t\t\t\treturn function () {\n\t\t\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar params = Array.prototype.slice.call(args);\n\t\t\t\t\tvar callback = params[1];\n\t\t\t\t\t_this7._sendMessage({\n\t\t\t\t\t\tapiId: apiId,\n\t\t\t\t\t\tactionId: _this7._eventReverseLookup[callback],\n\t\t\t\t\t\tname: methodName,\n\t\t\t\t\t\tparameters: params\n\t\t\t\t\t}, callback, callback);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// general api methods\n\t\t\treturn function () {\n\t\t\t\tfor (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n\t\t\t\t\targs[_key3] = arguments[_key3];\n\t\t\t\t}\n\n\t\t\t\tvar params = Array.prototype.slice.call(args);\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this7._sendMessage({\n\t\t\t\t\t\tapiId: apiId,\n\t\t\t\t\t\tactionId: CognosApi._createUID(methodName),\n\t\t\t\t\t\tname: methodName,\n\t\t\t\t\t\tparameters: params\n\t\t\t\t\t}, resolve, reject);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\t/**\n   * Static private method to to update the modules in the dashboard spec.\n   * @static\n   * @private\n  */\n\n\t}], [{\n\t\tkey: '_updateModuleDefinitions',\n\t\tvalue: function _updateModuleDefinitions(dashboardSpec, callback) {\n\t\t\tif (!dashboardSpec || !dashboardSpec.dataSources || !dashboardSpec.dataSources.sources) {\n\t\t\t\treturn Promise.resolve(dashboardSpec);\n\t\t\t}\n\n\t\t\tvar moduleClientIds = [];\n\t\t\tdashboardSpec.dataSources.sources.forEach(function (source) {\n\t\t\t\tif (source.clientId) {\n\t\t\t\t\tmoduleClientIds.push(source.clientId);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (moduleClientIds.length === 0) {\n\t\t\t\treturn Promise.resolve(dashboardSpec);\n\t\t\t}\n\n\t\t\tvar result = callback(moduleClientIds);\n\t\t\tif (result && typeof result.then === 'function') {\n\t\t\t\treturn result.then(function (newModules) {\n\t\t\t\t\treturn CognosApi._doModuleUpdate(dashboardSpec, newModules);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Promise.resolve(CognosApi._doModuleUpdate(dashboardSpec, result));\n\t\t}\n\n\t\t/**\n   * Static private method to to update the modules in the dashboard spec.\n   * @static\n   * @private\n   */\n\n\t}, {\n\t\tkey: '_doModuleUpdate',\n\t\tvalue: function _doModuleUpdate(dashboardSpec, newModules) {\n\t\t\tvar cloneDashboardSpec = JSON.parse(JSON.stringify(dashboardSpec));\n\t\t\tif (newModules) {\n\t\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\t\tvar _didIteratorError = false;\n\t\t\t\tvar _iteratorError = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tfor (var _iterator = cloneDashboardSpec.dataSources.sources[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\t\t\tvar source = _step.value;\n\t\t\t\t\t\tvar _iteratorNormalCompletion2 = true;\n\t\t\t\t\t\tvar _didIteratorError2 = false;\n\t\t\t\t\t\tvar _iteratorError2 = undefined;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tfor (var _iterator2 = newModules[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\t\t\t\t\tvar newModule = _step2.value;\n\n\t\t\t\t\t\t\t\tif (newModule.id === source.clientId) {\n\t\t\t\t\t\t\t\t\tif (newModule.module) {\n\t\t\t\t\t\t\t\t\t\tsource.module = newModule.module;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (newModule.name) {\n\t\t\t\t\t\t\t\t\t\tsource.name = newModule.name;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (newModule.newId && newModule.id !== newModule.newId) {\n\t\t\t\t\t\t\t\t\t\tsource.clientId = newModule.newId;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t_didIteratorError2 = true;\n\t\t\t\t\t\t\t_iteratorError2 = err;\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t\t\t\t\t_iterator2.return();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\t_didIteratorError = true;\n\t\t\t\t\t_iteratorError = err;\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t;\n\t\t\t}\n\n\t\t\treturn cloneDashboardSpec;\n\t\t}\n\n\t\t/**\n  * Static private method to create an unique identifier prepended with a give name\n   * @static\n  * @private\n  */\n\n\t}, {\n\t\tkey: '_createUID',\n\t\tvalue: function _createUID(prepend) {\n\t\t\tvar uid = Date.now().valueOf();\n\t\t\tCognosApi.__uid = CognosApi.__uid === uid ? uid + 1 : uid;\n\t\t\treturn prepend + '_' + CognosApi.__uid.toString(16);\n\t\t}\n\t}]);\n\n\treturn CognosApi;\n}();\n\n/**\n * Constant for event names used for on and off\n * @public\n * @readonly\n * @enum {string}\n * @memberof CognosApi\n */\n\n\nCognosApi.EVENTS = {\n\t/** Request error events.<br>\n Allows users to receive HTTP request error events. */\n\tREQUEST_ERROR: 'api:error:request'\n};\n\n/**\n * Constant for Api message header and initialization\n * @private\n */\nCognosApi.APIHEADER_DELIMITER = '#';\nCognosApi.APIHEADER_MARKER = 'capi';\nCognosApi.APIHEADER_VERSION = 'v1';\nCognosApi.APIHEADER = CognosApi.APIHEADER_DELIMITER + CognosApi.APIHEADER_MARKER + CognosApi.APIHEADER_DELIMITER + CognosApi.APIHEADER_VERSION;\n\nCognosApi.APISERVICE_INIT = 'getAppApi';\nCognosApi.APISERVICE_ON = 'on';\nCognosApi.APISERVICE_OFF = 'off';\nCognosApi.APISERVICE_DESTROY = 'destroyAppApi';\nCognosApi.APISERVICE_CLASS = 'capi-service';\n//# sourceMappingURL=CognosApi.js.map\n\n\nvar sessionObj = null;\nvar cognosApi = null;\n  $.get('https://darktribes.mybluemix.net/session', function(result) {\n          sessionObj = result;\n          cognosApi = new CognosApi({\n              cognosRootURL: 'https://dde-us-south.analytics.ibm.com/daas/',\n              sessionCode: sessionObj.sessionCode,\n              node: document.getElementById('sentiment')\n          });\n          cognosApi.initialize().then(function() {\n              cognosApi.dashboard.openDashboard({dashboardSpec: dashSpec}).then(\n                  function(dashboardAPI) {\n                      cognosApi.dashboardAPI = dashboardAPI;\n                  }\n              ).catch(\n                  function(err) {\n                      console.log(err);\n                  }\n              );\n          }, function(err) {\n              console.log('Failed to create API. ' + err.message);\n          });\n        });\n","output":"str","x":340,"y":460,"wires":[["493233cf.e4934c"]]},{"id":"66d8d4b3.7d6c94","type":"http in","z":"8246e271.253b4","name":"","url":"/cognosApi","method":"get","upload":false,"swaggerDoc":"","x":180,"y":460,"wires":[["464997b.5032a68"]]},{"id":"250d22e8.8ad9b6","type":"template","z":"8246e271.253b4","name":"main","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n\n  <head>\n\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n\n    <title></title>\n\n    <!-- Bootstrap core CSS -->\n    <!--<link href=\"vendor/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\">-->\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css\" integrity=\"sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB\" crossorigin=\"anonymous\">\n    <!-- Custom styles for this template -->\n    <link href=\"\" rel=\"stylesheet\" id=\"myOverlay\">\n\n\n  </head>\n\n  <body>\n\n    <!-- Navigation -->\n    <nav class=\"navbar fixed-top navbar-expand-lg navbar-dark bg-dark fixed-top\">\n      <div class=\"container\">\n        <a class=\"navbar-brand CompanyName\" href=\"index.html\" id=\"companyName\">Mega Media</a>\n        <button class=\"navbar-toggler navbar-toggler-right\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarResponsive\" aria-controls=\"navbarResponsive\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n          <span class=\"navbar-toggler-icon\"></span>\n        </button>\n        <div class=\"collapse navbar-collapse\" id=\"navbarResponsive\">\n          <ul class=\"navbar-nav ml-auto\">\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"about.html\">About</a>\n            </li>\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"services.html\">Services</a>\n            </li>\n            <li class=\"nav-item\">\n              <a class=\"nav-link\" href=\"contact.html\">Contact</a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </nav>\n\n    <header>\n      <div id=\"carouselExampleIndicators\" class=\"carousel slide\" data-ride=\"carousel\">\n        <ol class=\"carousel-indicators\">\n          <li data-target=\"#carouselExampleIndicators\" data-slide-to=\"0\" class=\"active\"></li>\n          <li data-target=\"#carouselExampleIndicators\" data-slide-to=\"1\"></li>\n          <li data-target=\"#carouselExampleIndicators\" data-slide-to=\"2\"></li>\n        </ol>\n        <div class=\"carousel-inner\" role=\"listbox\">\n          <!-- Slide One - Set the background image for this slide in the line below -->\n          <div class=\"carousel-item active\" style=\"background-image: url('//conciergevoiceserver.mybluemix.net/img/xx-slide-1.jpg')\">\n            <div class=\"carousel-caption d-none d-md-block\">\n              <h3>Our Parks</h3>\n              <p>Find out more about our parks and how we do things differently here at Mega Media</p>\n            </div>\n          </div>\n          <!-- Slide Two - Set the background image for this slide in the line below -->\n          <div class=\"carousel-item\" style=\"background-image: url('//conciergevoiceserver.mybluemix.net/img/xx-slide-2.jpg')\">\n            <div class=\"carousel-caption d-none d-md-block\">\n              <h3>Second Slide</h3>\n              <p>This is a description for the second slide.</p>\n            </div>\n          </div>\n          <!-- Slide Three - Set the background image for this slide in the line below -->\n          <div class=\"carousel-item\" style=\"background-image: url('//conciergevoiceserver.mybluemix.net/img/xx-slide-3.jpg')\">\n            <div class=\"carousel-caption d-none d-md-block\">\n              <h3>Third Slide</h3>\n              <p>This is a description for the third slide.</p>\n            </div>\n          </div>\n        </div>\n        <a class=\"carousel-control-prev\" href=\"#carouselExampleIndicators\" role=\"button\" data-slide=\"prev\">\n          <span class=\"carousel-control-prev-icon\" aria-hidden=\"true\"></span>\n          <span class=\"sr-only\">Previous</span>\n        </a>\n        <a class=\"carousel-control-next\" href=\"#carouselExampleIndicators\" role=\"button\" data-slide=\"next\">\n          <span class=\"carousel-control-next-icon\" aria-hidden=\"true\"></span>\n          <span class=\"sr-only\">Next</span>\n        </a>\n      </div>\n    </header>\n\n    <!-- Page Content -->\n    <div class=\"container\">\n\n      <h1 class=\"my-4 ContactUs\"></h1>\n\n      <!-- Marketing Icons Section -->\n      <div class=\"row\">\n\n        <div class=\"col-lg-4 mb-4\">\n          <div class=\"card h-100\">\n            <img class=\"card-img-top\" src=\"//conciergevoiceserver.mybluemix.net/img/liveTV.gif\"/>\n            <div class=\"card-img-overlay\">\n              <h4 class=\"card-title text-white-50\">Live: These Streets</h4>\n            </div>\n            <div class=\"card-body\">\n              <h5 class=\"card-title\" id=\"liveStreamTitle\">Live on MM</h5>\n              <p class=\"card-text\">Start your 30 day free trial of our live TV service. Only $14.99/mo after first 30 days</p>\n              <a href=\"#\" class=\"card-link\">Start 30-Day Trial</a>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"col-lg-4 mb-4\">\n          <div class=\"card h-100\">\n            <h4 class=\"card-header\">Behind the Scenes</h4>\n            <div class=\"card-body\">\n              <p class=\"card-text\">We go behind the scenes with Mr. Burns to discuss his upcoming </p>\n            </div>\n            <div class=\"card-footer\">\n              <a href=\"#\" class=\"btn btn-primary myButton\">Call Support</a>\n            </div>\n          </div>\n        </div>\n      </div>\n      <!-- /.row -->\n\n    </div>\n    <!-- /.container -->\n\n    <!-- Footer -->\n    <footer class=\"py-5 bg-dark\">\n      <div class=\"container\">\n        <p class=\"m-0 text-center text-white bg-dark\">Powered by IBM Watson</p>\n      </div>\n      <!-- /.container -->\n    </footer>\n\n    <!-- Bootstrap core JavaScript -->\n    <script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" integrity=\"sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=\"\n            crossorigin=\"anonymous\"></script>\n    <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js\"></script>\n\n    <script language=\"JavaScript\">\n        // Read a page's GET URL variables and return them as an associative array.\n        function getUrlVars()\n        {\n            var vars = [], hash;\n            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');\n            for(var i = 0; i < hashes.length; i++)\n            {\n                hash = hashes[i].split('=');\n                vars.push(hash[0]);\n                vars[hash[0]] = hash[1];\n            }\n            return vars;\n        }\n\n        var overlay = getUrlVars()['industry'];\n        var companyName, cssFile, staticFilePrefix, liveStreamTitle;\n\n\n        $(function () {\n            switch (overlay) {\n                case \"0\":\n                    companyName = 'Mega Media';\n                    staticFilePrefix = 'mm';\n                    liveStreamTitle = 'MegaMedia Channel Live'\n                    break;\n                case \"1\":\n                    companyName = 'SportsNet';\n                    staticFilePrefix = 'sb';\n                    liveStreamTitle = 'SportsBall Channel Live'\n                    break;\n            }\n\n            //running overlays\n            $('#companyName').text(companyName);\n            $('#liveStreamTitle').text(liveStreamTitle)\n            $('head link#myOverlay').attr('href', '//conciergevoiceserver.mybluemix.net/css/' + staticFilePrefix + '-overlay.css');\n            // $('head link#myOverlay').attr('href', 'css/' + staticFilePrefix + '-overlay.css');\n            // Swapping out the images\n            $('.carousel-item').each(function (ix, val) {\n                var newVal;\n                newVal = $(this).attr('style').replace('xx', staticFilePrefix);\n                $(this).attr('style', newVal);\n\n                }\n            );\n\n        });\n\n    </script>\n\n\n  </body>\n\n</html>\n","output":"str","x":310,"y":80,"wires":[["d1003420.4bca3"]]},{"id":"75b916fd.33aec","type":"http in","z":"8246e271.253b4","name":"","url":"/main","method":"get","upload":false,"swaggerDoc":"","x":160,"y":80,"wires":[["250d22e8.8ad9b6"]]},{"id":"fc1c5405.e66c6","type":"dashDB out","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","table":"DISCOVERY_CALL_LOG","name":"Discovery Log","x":1000,"y":631,"wires":[]},{"id":"664942d.2625c3c","type":"function","z":"45bfaeea.5a7458","name":"process","func":"msg.payload = msg.search_results.results;\n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":631,"wires":[["ff4f0753.ea472"]]},{"id":"c157007.5cd7c8","type":"watson-discovery-v1","z":"45bfaeea.5a7458","name":"discovery","environmentname":"","environment_id":"142065f5-715e-4a7a-abbe-59ef0252d4a2","collection_id":"b67e8cc8-cea0-419e-8eef-32cba7415fd5","configurationname":"","configuration_id":"","language_code":"en","collection_name":"","count":"3","passages":true,"nlp_query":true,"query":"","filter":"","aggregation":"","return":"","description":"","size":0,"discovery-method":"query","default-endpoint":true,"service-endpoint":"https://gateway.watsonplatform.net/discovery/api","x":400,"y":631,"wires":[["664942d.2625c3c"]]},{"id":"eb46e3f.178762","type":"function","z":"45bfaeea.5a7458","name":"pre disc","func":"msg.discoveryparams = {};\nmsg.discoveryparams.query = msg.text;\n// msg.user = '18586995802';\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":631,"wires":[["c157007.5cd7c8"]]},{"id":"ff4f0753.ea472","type":"split","z":"45bfaeea.5a7458","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":690,"y":631,"wires":[["d082a609.ad2f78"]]},{"id":"d082a609.ad2f78","type":"function","z":"45bfaeea.5a7458","name":"prep","func":"var url = \"https://discovery-docs.mybluemix.net/docs/\";\n\nif(msg.payload.extracted_metadata.file_type === \"html\"){\n    url = msg.payload.extracted_metadata.filename.replace(/:/g,'/').replace('-',':').replace(/.htm( |l)/,'');\n} else {\n    url += msg.payload.extracted_metadata.filename;\n}\n\nmsg.payload = \n\n    {\n        USER : msg.user,\n        FILENAME: msg.payload.extracted_metadata.filename,\n        DT_TIME: 'TIMESTAMP',\n        ID: msg.parts.id + '_' + msg.parts.index,\n        SCORE: msg.payload.result_metadata.score,\n        TITLE: msg.payload.extracted_metadata.title,\n        FILETYPE: msg.payload.extracted_metadata.file_type,\n        QUERY: msg.discoveryparams.query,\n        RESULTCOUNT: msg.parts.count,\n        URL: url,\n        ACTIVE: 1\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":631,"wires":[["fc1c5405.e66c6","d78a37a3.8d6c58"]]},{"id":"8483a2ac.1976f","type":"dashDB in","z":"45bfaeea.5a7458","dashDB":"759a025.71509fc","service":"_ext_","query":"UPDATE DASH5337.DISCOVERY_CALL_LOG\nSET ACTIVE = 0\nWHERE ACTIVE=1 AND \"USER\" = ?","params":"msg.user","name":"Update discovery_call_log","x":740,"y":960,"wires":[[]]},{"id":"a6fea4dc.3a7e08","type":"inject","z":"45bfaeea.5a7458","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":960,"wires":[["80edec20.d05bc8"]]},{"id":"80edec20.d05bc8","type":"function","z":"45bfaeea.5a7458","name":"update active status of discovery_call_log","func":"msg.user = '17024678194';\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":960,"wires":[["8483a2ac.1976f"]]},{"id":"6ee3dc5d.ca2334","type":"template","z":"8246e271.253b4","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Discovery Call Log</title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" >\n    \n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\">\n    <link rel=\"stylesheet\" href=\"https://darktribes.mybluemix.net/stylesheets/style.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js\"></script>\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js\" ></script>  \n    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>\n    \n    <style>\n      .btn-default{ text-align: center; }\n    input[type=\"checkbox\"]{\n        margin-right:8px;\n    }\n\n    p{\n        margin: 0 0 2px;\n        clear:both;\n    }\n    \n    p.size{\n        font-size: 14px;\n    }\n        .cont1{\n            width: 100% !important;\n            height: 100% !important;\n            overflow: hidden !important;\n        }\n\n        .cont2{\n            width: 100% !important;\n            height: 100% !important;\n            overflow: auto !important;\n            padding-right: 15px !important;\n        }\n        \n        .chat\n        {\n            list-style: none;\n            margin: 0;\n            padding: 0;\n        }\n        \n        .chat li\n        {\n            margin-bottom: 10px;\n            padding-bottom: 5px;\n            border-bottom: 1px dotted #B3A9A9;\n        }\n        \n        .chat li.left .chat-body\n        {\n            margin-left: 60px;\n        }\n        \n        .chat li.right .chat-body\n        {\n            margin-right: 60px;\n        }\n        \n        \n        .chat li .chat-body p\n        {\n            margin: 0;\n            color: #777777;\n        }\n        \n        .panel .slidedown .glyphicon, .chat .glyphicon\n        {\n            margin-right: 5px;\n        }\n        \n        .panel-body{\n            color: black;\n            background-color: white;\n        }\n        .jumbotron{\n            margin-top:40px;\n        }\n        \n        .thumb {\n            font-size:25px;\n            color:green;\n        }\n    </style>\n  </head>\n  <body>\n<div class=\"container-fluid\" style=\"padding:10px\">\n  <div ><H3>Discovery Search Results</H3></div>\n  <div class=\"row\">\n    <div class=\"col-sm-12\" >\n      <div class=\"panel panel-default\">\n  <div class=\"panel-heading\"><h3>Request Log</h3></div>\n  <div id=\"discovery_log\" class=\"panel-body\"></div>\n</div>\n      </div>\n    </div>\n  </div>\n</div>\n  </body>\n    <script src=\"/jsdiscovery\"></script>\n \n    \n  </html>","output":"str","x":360,"y":520,"wires":[["fd7bfad9.b0e6f"]]},{"id":"fd7bfad9.b0e6f","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"text/html","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":525,"y":518,"wires":[["67cbcc0c.c6bad4"]]},{"id":"6042f3b7.b1b694","type":"http in","z":"8246e271.253b4","name":"","url":"/discovery","method":"get","upload":false,"swaggerDoc":"","x":180,"y":520,"wires":[["6ee3dc5d.ca2334"]]},{"id":"f8466c5b.3bc558","type":"http in","z":"8246e271.253b4","name":"","url":"/jsdiscovery","method":"get","upload":false,"swaggerDoc":"","x":179,"y":567,"wires":[["3542c301.cd7054"]]},{"id":"7b62e55f.90c59c","type":"change","z":"8246e271.253b4","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/javascript","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":526,"y":571,"wires":[["67cbcc0c.c6bad4"]]},{"id":"3542c301.cd7054","type":"template","z":"8246e271.253b4","name":"script","field":"payload","fieldType":"msg","format":"javascript","syntax":"plain","template":"var getUrlParameter = function getUrlParameter(sParam) {\n    var sPageURL = decodeURIComponent(window.location.search.substring(1)),\n        sURLVariables = sPageURL.split('&'),\n        sParameterName,\n        i;\n\n    for (i = 0; i < sURLVariables.length; i++) {\n        sParameterName = sURLVariables[i].split('=');\n\n        if (sParameterName[0] === sParam) {\n            return sParameterName[1] === undefined ? true : sParameterName[1];\n        }\n    }\n};\n\n\nvar results = \"\";\nvar yourPhone = getUrlParameter('yourPhone');\n\nfunction processData(data){\n    var ID=\"\";\n    var element = \"<div>\";\n    data.forEach(item=>{\n        //process a group of results together\n        if(parseInt(item.ID.split(\"_\")[1])===0){\n            element += \"<h4>\" + item.QUERY + \"</h4><ol>\";\n        }\n        \n        if(parseInt(item.ID.split(\"_\")[1]) < item.RESULTCOUNT - 1){\n            \n            element += '<li><a class=\"doc\" href=\"' + item.URL + '\" target=\"_blank\" doctype=' + item.FILETYPE  +  '>' + item.TITLE + \"   </a><i class='fa fa-thumbs-o-up' aria-hidden='true'></i></span></li>\\n\";\n        } else {\n            //push the built up element to the page\n            element += '<li><a class=\"doc\" href=\"' + item.URL + '\" target=\"_blank\" doctype=' + item.FILETYPE  +  '>' + item.TITLE + \"   </a><i class='fa fa-thumbs-o-up' aria-hidden='true'></i></li>\\n\" ;\n            $(\"#discovery_log\").prepend(element)\n            element = \"</ol><div>\";\n        }\n        \n        \n    })\n    \n    //add the upvote option\n    $(\"i\").click((ev)=>{\n        \n        $target = $(ev.target);\n        if($target.hasClass('thumb')){\n            $target.removeClass('thumb');\n        } else {\n            $target.addClass('thumb');\n        }\n    })   \n}\n\n$.get(\"https://customerconcierge.mybluemix.net/discoverylog?yourPhone=\" + yourPhone  ,function(data){\n    processData(data);\n});\n\nvar socket;\n\nfunction connect(){\n    var host = \"wss://customerconcierge.mybluemix.net/ws/discovery\";\n    try {\n        socket = new WebSocket(host);\n        socket.onopen = function(){console.log(\"discovery socket connected\");}\n        socket.onmessage = function(msg){\n            \n            //add data to my page \n            //debugger;\n            var json = JSON.parse(msg.data);\n            processData(json);\n        }\n        socket.onclose = function () {\n            console.log(\"discovery socket closed\");\n            var time = generateInterval(attempts);\n            setTimeout(connect,3000);\n        }\n    } catch(exception){\n        console.log('Discovery Socket Error:' +exception);\n    }\n    \n    function send(){\n        var text = \"\";\n        \n    }\n    function generateInterval (k) {\n        var maxInterval = (Math.pow(2, k) - 1) * 1000;\n        if (maxInterval > 30*1000) {\n            maxInterval = 30*1000; \n        }\n        return Math.random() * maxInterval; \n    }\n    \n}    \n\nif(!(\"WebSocket\" in window)){}\nelse {\n    connect();\n}","x":347,"y":570,"wires":[["7b62e55f.90c59c"]]},{"id":"67cbcc0c.c6bad4","type":"http response","z":"8246e271.253b4","name":"","statusCode":"","headers":{},"x":711,"y":518,"wires":[]},{"id":"b3f7f00e.6098b","type":"http in","z":"8246e271.253b4","name":"","url":"/discoverylog","method":"get","upload":false,"swaggerDoc":"","x":189.5,"y":612,"wires":[["6742b9d2.ebf2f"]]},{"id":"36ace25e.25930e","type":"http response","z":"8246e271.253b4","name":"","statusCode":"","headers":{},"x":562.5,"y":611,"wires":[]},{"id":"6742b9d2.ebf2f","type":"dashDB in","z":"8246e271.253b4","dashDB":"759a025.71509fc","service":"_ext_","query":"SELECT * FROM dash5337.DISCOVERY_CALL_LOG\nWHERE ACTIVE=1 AND \"USER\" = ?\nORDER BY DT_TIME, ID","params":"msg.payload.yourPhone","name":"","x":383.5,"y":611,"wires":[["36ace25e.25930e"]]},{"id":"d78a37a3.8d6c58","type":"join","z":"45bfaeea.5a7458","name":"","mode":"auto","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":970,"y":580,"wires":[["78e00cb4.e05724"]]},{"id":"78e00cb4.e05724","type":"websocket out","z":"45bfaeea.5a7458","name":"","server":"82e8c1b2.88f33","client":"","x":1130,"y":580,"wires":[]},{"id":"bcd12bd6.47bc08","type":"comment","z":"8246e271.253b4","name":"cognos backup","info":"var dashSpec = {\n    \"name\":\"New dashboard\",\n    \"layout\": {\n        \"id\":\"page0\",\n        \"items\":[ {\n            \"id\": \"page1\", \"items\": [ \n        {\n            \"id\":\"model00000163f5e901e2_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"240px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        }\n        ,\n        {\n            \"id\":\"model00000163faa38c50_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"240px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        },\n        {\n            \"id\":\"model00000163faae1960_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"380px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        },\n        {\n            \"id\":\"model00000164008cb5ce_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"240px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        }\n        ,\n        {\n            \"id\":\"model000001640098ef5a_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"240px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        }\n        ,\n        {\n            \"id\":\"model00000164009d22c0_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"190px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        }\n        ,\n        {\n            \"id\":\"model00000164009fd2d2_00000000\",\n            \"style\": {\n                \"height\": \"200px\", \"width\": \"190px\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        }\n        ,\n        {\n            \"id\":\"model0000016401b3c240_00000000\",\n            \"style\": {\n                \"height\": \"115px\", \"width\": \"100%\", \"float\": \"left\", \"position\": \"relative\"\n            }\n            ,\n            \"type\":\"widget\"\n        }\n        \n    ], \"type\": \"absolute\", \"title\": \"Dashboard\", \"templateName\": \"NoTemplate\"\n        }\n        ,\n        {\n            \"id\": \"model0000016401ab1e7a_00000000\", \"items\": [\n            ], \"type\": \"absolute\", \"title\": \"Account Info\", \"templateName\": \"NoTemplate\"\n        }\n        ],\n        \"style\": {\n            \"height\": \"100%\"\n        }\n        ,\n        \"type\":\"tab\"\n    }\n    ,\n    \"theme\":\"defaultTheme\",\n    \"version\":1008,\n    \"eventGroups\":[ {\n        \"id\": \"page0:1\", \"widgetIds\": [\"model00000163f5e901e2_00000000\"]\n    }\n    ],\n    \"dataSources\": {\n        \"version\":\"1.0\",\n        \"sources\":[ {\n            \"id\":\"model00000163f5e8d8dc_00000001\",\n            \"assetId\":\"assetId00000163f5e8d8da_00000000\",\n            \"clientId\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n            \"module\": {\n                \"xsd\":\"https://ibm.com/daas/module/1.0/module.xsd\",\n                \"source\": {\n                    \"id\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n                    \"user\":\"dash5337\",\n                    \"password\":\"5rg0CUpk__TM\",\n                    \"jdbc\": {\n                        \"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n                        \"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n                        \"schema\": \"DASH5337\"\n                    }\n                }\n                ,\n                \"label\":\"SENTIMENT\",\n                \"identifier\":\"SENTIMENT\",\n                \"table\": {\n                    \"column\":[ {\n                        \"datatype\": \"varchar(15)\", \"nullable\": true, \"name\": \"USER\", \"label\": \"USER\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"timestamp\", \"nullable\": true, \"name\": \"ETIME\", \"label\": \"ETIME\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"decimal(8)\", \"nullable\": true, \"name\": \"SCORE\", \"label\": \"SCORE\", \"usage\": \"fact\", \"regularAggregate\": \"total\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ],\n                    \"name\":\"SENTIMENT\",\n                    \"description\":\"\"\n                }\n            }\n            ,\n            \"name\":\"SENTIMENT\",\n            \"shaping\": {\n                \"embeddedModuleUpToDate\": true\n            }\n        }\n        ,\n        {\n            \"id\":\"model00000163fa696206_00000001\",\n            \"assetId\":\"assetId00000163fa696204_00000000\",\n            \"clientId\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_CLASSIFICATION:table\",\n            \"module\": {\n                \"xsd\":\"https://ibm.com/daas/module/1.0/module.xsd\",\n                \"source\": {\n                    \"id\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n                    \"user\":\"dash5337\",\n                    \"password\":\"5rg0CUpk__TM\",\n                    \"jdbc\": {\n                        \"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n                        \"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n                        \"schema\": \"DASH5337\"\n                    }\n                }\n                ,\n                \"label\":\"CALL_CLASSIFICATION\",\n                \"identifier\":\"CALL_CLASSIFICATION\",\n                \"table\": {\n                    \"column\":[ {\n                        \"datatype\": \"varchar(15)\", \"nullable\": true, \"name\": \"USER\", \"label\": \"USER\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"CLASS_NAME\", \"label\": \"CLASS_NAME\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"decimal(8)\", \"nullable\": true, \"name\": \"CONFIDENCE\", \"label\": \"CONFIDENCE\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ],\n                    \"name\":\"CALL_CLASSIFICATION\",\n                    \"description\":\"\"\n                }\n            }\n            ,\n            \"name\":\"CALL_CLASSIFICATION\",\n            \"shaping\": {\n                \"shapingId\":\"shaping00000163faa87bbe_00000000\",\n                \"embeddedModuleUpToDate\":false,\n                \"moserJSON\": {\n                    \"version\":\"5.0\",\n                    \"container\":\"C\",\n                    \"useSpec\":[ {\n                        \"identifier\": \"ES\", \"type\": \"url\", \"storeID\": \"baseModule\", \"imports\": \"*\"\n                    }\n                    ],\n                    \"expressionLocale\":\"en-us\",\n                    \"querySubject\":[ {\n                        \"ref\":[\"ES.CALL_CLASSIFICATION\"],\n                        \"instanceType\":\"reference\",\n                        \"item\":[ {\n                            \"queryItem\": {\n                                \"usage\":\"fact\",\n                                \"regularAggregate\":\"none\",\n                                \"identifier\":\"CONFIDENCE\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_170\", \"value\": \"true\"\n                                }\n                                ,\n                                {\n                                    \"name\": \"propertySetByUser_165\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ],\n                        \"identifier\":\"CALL_CLASSIFICATION\"\n                    }\n                    ],\n                    \"dataRetrievalMode\":\"liveConnection\",\n                    \"identifier\":\"newModel\",\n                    \"label\":\"newModel\"\n                }\n            }\n        }\n        ,\n        {\n            \"id\":\"model00000163fa699ad8_00000001\",\n            \"assetId\":\"assetId00000163fa699ad2_00000000\",\n            \"clientId\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_TONE:table\",\n            \"module\": {\n                \"xsd\":\"https://ibm.com/daas/module/1.0/module.xsd\",\n                \"source\": {\n                    \"id\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n                    \"user\":\"dash5337\",\n                    \"password\":\"5rg0CUpk__TM\",\n                    \"jdbc\": {\n                        \"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n                        \"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n                        \"schema\": \"DASH5337\"\n                    }\n                }\n                ,\n                \"label\":\"CALL_TONE\",\n                \"identifier\":\"CALL_TONE\",\n                \"table\": {\n                    \"column\":[ {\n                        \"datatype\": \"varchar(15)\", \"nullable\": true, \"name\": \"USER\", \"label\": \"USER\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"TONE_NAME\", \"label\": \" \", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"decimal(8)\", \"nullable\": true, \"name\": \"SCORE\", \"label\": \"SCORE\", \"usage\": \"fact\", \"regularAggregate\": \"total\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ],\n                    \"name\":\"CALL_TONE\",\n                    \"description\":\"\"\n                }\n            }\n            ,\n            \"name\":\"CALL_TONE\",\n            \"shaping\": {\n                \"shapingId\":\"shaping00000163fab09cd8_00000000\",\n                \"embeddedModuleUpToDate\":false,\n                \"moserJSON\": {\n                    \"version\":\"5.0\",\n                    \"container\":\"C\",\n                    \"useSpec\":[ {\n                        \"identifier\": \"ES\", \"type\": \"url\", \"storeID\": \"baseModule\", \"imports\": \"*\"\n                    }\n                    ],\n                    \"expressionLocale\":\"en-us\",\n                    \"querySubject\":[ {\n                        \"ref\":[\"ES.CALL_TONE\"],\n                        \"instanceType\":\"reference\",\n                        \"item\":[ {\n                            \"queryItem\": {\n                                \"usage\":\"identifier\",\n                                \"identifier\":\"USER_\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_165\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ],\n                        \"identifier\":\"CALL_TONE\"\n                    }\n                    ],\n                    \"dataRetrievalMode\":\"liveConnection\",\n                    \"identifier\":\"newModel\",\n                    \"label\":\"newModel\"\n                }\n            }\n        },\n        {\n            \"id\":\"model0000016400368196_00000001\",\n            \"assetId\":\"assetId0000016400368194_00000000\",\n            \"clientId\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_UPSELL:table\",\n            \"module\": {\n                \"xsd\":\"https://ibm.com/daas/module/1.0/module.xsd\",\n                \"source\": {\n                    \"id\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n                    \"user\":\"dash5337\",\n                    \"password\":\"5rg0CUpk__TM\",\n                    \"jdbc\": {\n                        \"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n                        \"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n                        \"schema\": \"DASH5337\"\n                    }\n                }\n                ,\n                \"label\":\"CALL_UPSELL\",\n                \"identifier\":\"CALL_UPSELL\",\n                \"table\": {\n                    \"column\":[ {\n                        \"datatype\": \"varchar(15)\", \"nullable\": true, \"name\": \"USER\", \"label\": \"USER\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"PRODUCT\", \"label\": \"PRODUCT\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"decimal(8)\", \"nullable\": true, \"name\": \"PROBABILITY\", \"label\": \"PROBABILITY\", \"usage\": \"fact\", \"regularAggregate\": \"total\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ],\n                    \"name\":\"CALL_UPSELL\",\n                    \"description\":\"\"\n                }\n            }\n            ,\n            \"name\":\"CALL_UPSELL\",\n            \"shaping\": {\n                \"shapingId\":\"shaping000001640063ab24_00000000\",\n                \"embeddedModuleUpToDate\":false,\n                \"moserJSON\": {\n                    \"version\":\"5.0\",\n                    \"container\":\"C\",\n                    \"useSpec\":[ {\n                        \"identifier\": \"ES\", \"type\": \"url\", \"storeID\": \"baseModule\", \"imports\": \"*\"\n                    }\n                    ],\n                    \"expressionLocale\":\"en-us\",\n                    \"querySubject\":[ {\n                        \"ref\":[\"ES.CALL_UPSELL\"],\n                        \"instanceType\":\"reference\",\n                        \"item\":[ {\n                            \"queryItem\": {\n                                \"regularAggregate\":\"maximum\",\n                                \"identifier\":\"PROBABILITY\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_170\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ],\n                        \"identifier\":\"CALL_UPSELL\"\n                    }\n                    ],\n                    \"dataRetrievalMode\":\"liveConnection\",\n                    \"identifier\":\"newModel\",\n                    \"label\":\"newModel\"\n                }\n            }\n        }\n        ,\n        {\n            \"id\":\"model0000016400833ab8_00000000\",\n            \"assetId\":\"assetId0000016400833ab6_00000000\",\n            \"clientId\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/USERS:table\",\n            \"module\": {\n                \"xsd\":\"https://ibm.com/daas/module/1.0/module.xsd\",\n                \"source\": {\n                    \"id\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n                    \"user\":\"dash5337\",\n                    \"password\":\"5rg0CUpk__TM\",\n                    \"jdbc\": {\n                        \"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n                        \"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n                        \"schema\": \"DASH5337\"\n                    }\n                }\n                ,\n                \"label\":\"USERS\",\n                \"identifier\":\"USERS\",\n                \"table\": {\n                    \"column\":[ {\n                        \"datatype\": \"varchar(11)\", \"nullable\": true, \"name\": \"ID\", \"label\": \"ID\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(1)\", \"nullable\": true, \"name\": \"GENDER\", \"label\": \"Sex\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"smallint\", \"nullable\": true, \"name\": \"AGE\", \"label\": \"Age\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"MAIDEN_NAME\", \"label\": \"MAIDEN_NAME\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"LNAME\", \"label\": \"Last\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"FNAME\", \"label\": \"First\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"ADDRESS\", \"label\": \"Address\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cStreetAddress\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"CITY\", \"label\": \"City\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cCity\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"STATE\", \"label\": \"STATE\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cStateProvince\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"integer\", \"nullable\": true, \"name\": \"ZIP\", \"label\": \"ZIP\", \"usage\": \"fact\", \"regularAggregate\": \"total\", \"taxonomyFamily\": \"cPostalCode\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"COUNTRY\", \"label\": \"COUNTRY\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cCountry\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"bigint\", \"nullable\": true, \"name\": \"PHONE\", \"label\": \"Phone\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(255)\", \"nullable\": true, \"name\": \"EMAIL\", \"label\": \"EMAIL\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"varchar(19)\", \"nullable\": true, \"name\": \"CC_NUMBER\", \"label\": \"CC_NUMBER\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"smallint\", \"nullable\": true, \"name\": \"MONTHLY_PAYMENT\", \"label\": \"Payment\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cMonth\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"smallint\", \"nullable\": true, \"name\": \"TOTAL_PAYMENTS\", \"label\": \"TOTAL_PAYMENTS\", \"usage\": \"fact\", \"regularAggregate\": \"total\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ],\n                    \"name\":\"USERS\",\n                    \"description\":\"\"\n                }\n            }\n            ,\n            \"name\":\"USERS\",\n            \"shaping\": {\n                \"shapingId\":\"shaping0000016400adfdbe_00000000\",\n                \"embeddedModuleUpToDate\":false,\n                \"moserJSON\": {\n                    \"version\":\"5.0\",\n                    \"container\":\"C\",\n                    \"useSpec\":[ {\n                        \"identifier\": \"ES\", \"type\": \"url\", \"storeID\": \"baseModule\", \"imports\": \"*\"\n                    }\n                    ],\n                    \"expressionLocale\":\"en-us\",\n                    \"querySubject\":[ {\n                        \"ref\":[\"ES.USERS\"],\n                        \"instanceType\":\"reference\",\n                        \"item\":[ {\n                            \"queryItem\": {\n                                \"regularAggregate\":\"none\",\n                                \"identifier\":\"ADDRESS\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_170\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ,\n                        {\n                            \"queryItem\": {\n                                \"regularAggregate\":\"none\",\n                                \"identifier\":\"CITY\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_170\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ,\n                        {\n                            \"queryItem\": {\n                                \"usage\":\"fact\",\n                                \"regularAggregate\":\"maximum\",\n                                \"identifier\":\"TOTAL_PAYMENTS\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_170\", \"value\": \"true\"\n                                }\n                                ,\n                                {\n                                    \"name\": \"propertySetByUser_165\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ],\n                        \"identifier\":\"USERS\"\n                    }\n                    ],\n                    \"calculation\":[ {\n                        \"expression\":\"maximum(USERS.TOTAL_PAYMENTS)\",\n                        \"usage\":\"fact\",\n                        \"datatype\":\"SMALLINT\",\n                        \"nullable\":true,\n                        \"regularAggregate\":\"calculated\",\n                        \"datatypeCategory\":\"number\",\n                        \"highlevelDatatype\":\"integer\",\n                        \"facetDefinition\": {\n                            \"enabled\": \"automatic\"\n                        }\n                        ,\n                        \"identifier\":\"Calculation_name\",\n                        \"label\":\"Group Total\",\n                        \"property\":[ {\n                            \"name\":\"ui_expr\",\n                            \"value\":\"{\\\"func\\\":\\\"customCalculation\\\",\\\"version\\\":\\\"5.0\\\"}\"\n                        }\n                        ,\n                        {\n                            \"name\": \"propertySetByUser_116\", \"value\": \"true\"\n                        }\n                        ],\n                        \"propertyOverride\":[\"NEW\"]\n                    }\n                    ,\n                    {\n                        \"expression\":\"total(\\nif (USERS.PHONE = \" + yourPhone + \")\\nthen (USERS.TOTAL_PAYMENTS)\\nelse (null)\\n\\n)\",\n                        \"usage\":\"fact\",\n                        \"datatype\":\"SMALLINT\",\n                        \"nullable\":true,\n                        \"regularAggregate\":\"calculated\",\n                        \"datatypeCategory\":\"number\",\n                        \"highlevelDatatype\":\"integer\",\n                        \"facetDefinition\": {\n                            \"enabled\": \"automatic\"\n                        }\n                        ,\n                        \"identifier\":\"Calculation_name_1\",\n                        \"label\":\"User Total\",\n                        \"property\":[ {\n                            \"name\":\"ui_expr\",\n                            \"value\":\"{\\\"func\\\":\\\"customCalculation\\\",\\\"version\\\":\\\"5.0\\\"}\"\n                        }\n                        ,\n                        {\n                            \"name\": \"propertySetByUser_116\", \"value\": \"true\"\n                        }\n                        ],\n                        \"propertyOverride\":[\"NEW\"]\n                    }\n                    ,\n                    {\n                        \"expression\":\"Calculation_name_1/ Calculation_name\",\n                        \"usage\":\"fact\",\n                        \"datatype\":\"DOUBLE\",\n                        \"nullable\":true,\n                        \"regularAggregate\":\"calculated\",\n                        \"datatypeCategory\":\"number\",\n                        \"highlevelDatatype\":\"decimal\",\n                        \"facetDefinition\": {\n                            \"enabled\": \"automatic\"\n                        }\n                        ,\n                        \"identifier\":\"Calculation_name_2\",\n                        \"label\":\"uvalue\",\n                        \"property\":[ {\n                            \"name\":\"ui_expr\",\n                            \"value\":\"{\\\"func\\\":\\\"customCalculation\\\",\\\"version\\\":\\\"5.0\\\"}\"\n                        }\n                        ,\n                        {\n                            \"name\": \"propertySetByUser_116\", \"value\": \"true\"\n                        }\n                        ],\n                        \"propertyOverride\":[\"NEW\"]\n                    }\n                    ],\n                    \"metadataTreeView\":[ {\n                        \"folderItem\":[ {\n                            \"ref\": \"Calculation_name\"\n                        }\n                        ,\n                        {\n                            \"ref\": \"Calculation_name_1\"\n                        }\n                        ,\n                        {\n                            \"ref\": \"Calculation_name_2\"\n                        }\n                        ]\n                    }\n                    ],\n                    \"dataRetrievalMode\":\"liveConnection\",\n                    \"identifier\":\"newModel\",\n                    \"label\":\"newModel\"\n                }\n            }\n        }\n        ,\n        {\n            \"id\":\"model00000164009cf3ae_00000002\",\n            \"assetId\":\"assetId00000164009cf3ae_00000000\",\n            \"clientId\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/CALL_RISK:table\",\n            \"module\": {\n                \"xsd\":\"https://ibm.com/daas/module/1.0/module.xsd\",\n                \"source\": {\n                    \"id\":\"bebeb7ae-f9af-4a31-8cc8-4113637e6061:f6615b4b-3a5b-4cf9-a2f7-d111dcd9d2e6:/DASH5337/SENTIMENT:table\",\n                    \"user\":\"dash5337\",\n                    \"password\":\"5rg0CUpk__TM\",\n                    \"jdbc\": {\n                        \"jdbcUrl\": \"jdbc:db2://dashdb-entry-yp-dal10-01.services.dal.bluemix.net:50000/BLUDB\",\n                        \"driverClassName\": \"com.ibm.db2.jcc.DB2Driver\",\n                        \"schema\": \"DASH5337\"\n                    }\n                }\n                ,\n                \"label\":\"CALL_RISK\",\n                \"identifier\":\"CALL_RISK\",\n                \"table\": {\n                    \"column\":[ {\n                        \"datatype\": \"varchar(15)\", \"nullable\": true, \"name\": \"USER\", \"label\": \"USER\", \"usage\": \"attribute\", \"regularAggregate\": \"countDistinct\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ,\n                    {\n                        \"datatype\": \"decimal(8)\", \"nullable\": true, \"name\": \"RISK\", \"label\": \"RISK\", \"usage\": \"fact\", \"regularAggregate\": \"total\", \"taxonomyFamily\": \"cNone\"\n                    }\n                    ],\n                    \"name\":\"CALL_RISK\",\n                    \"description\":\"\"\n                }\n            }\n            ,\n            \"name\":\"CALL_RISK\",\n            \"shaping\": {\n                \"shapingId\":\"shaping00000164009d5fb8_00000000\",\n                \"embeddedModuleUpToDate\":false,\n                \"moserJSON\": {\n                    \"version\":\"5.0\",\n                    \"container\":\"C\",\n                    \"useSpec\":[ {\n                        \"identifier\": \"ES\", \"type\": \"url\", \"storeID\": \"baseModule\", \"imports\": \"*\"\n                    }\n                    ],\n                    \"expressionLocale\":\"en-us\",\n                    \"querySubject\":[ {\n                        \"ref\":[\"ES.CALL_RISK\"],\n                        \"instanceType\":\"reference\",\n                        \"item\":[ {\n                            \"queryItem\": {\n                                \"regularAggregate\":\"none\",\n                                \"identifier\":\"RISK\",\n                                \"property\":[ {\n                                    \"name\": \"propertySetByUser_170\", \"value\": \"true\"\n                                }\n                                ]\n                            }\n                        }\n                        ],\n                        \"identifier\":\"CALL_RISK\"\n                    }\n                    ],\n                    \"dataRetrievalMode\":\"liveConnection\",\n                    \"identifier\":\"newModel\",\n                    \"label\":\"newModel\"\n                }\n            }\n        }\n        ]\n    }\n    ,\n    \"pageContext\":[],\n    \"drillThrough\":[],\n    \"widgets\": {\n        \"model00000163f5e901e2_00000000\": {\n            \"id\":\"model00000163f5e901e2_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model00000163f5e8d8dc_00000001\",\n                    \"dataItems\":[ {\n                        \"id\": \"model00000163f5e92ada_00000001\", \"itemId\": \"SENTIMENT.ETIME\", \"itemLabel\": \"ETIME\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model00000163f5e938cc_00000000\", \"itemId\": \"SENTIMENT.SCORE\", \"itemLabel\": \"SCORE\"\n                    }\n                    ],\n                    \"id\":\"model00000163f5e92ada_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\": \"categories\", \"dataItems\": [\"model00000163f5e92ada_00000001\"], \"dataItemSettings\": [], \"caption\": \"x-axis\", \"id\": \"categories\"\n                }\n                ,\n                {\n                    \"name\": \"values\", \"dataItems\": [\"model00000163f5e938cc_00000000\"], \"caption\": \"y-axis\", \"id\": \"values\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"com.ibm.vis.rave2line\",\n            \"name\":\"Sentiment\",\n            \"localFilters\":[ {\n                \"id\":\"SENTIMENT.USER_\",\n                \"columnId\":\"SENTIMENT.USER_\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"SENTIMENT.USER_->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ,\n            {\n                \"id\":\"SENTIMENT.ETIME\",\n                \"columnId\":\"SENTIMENT.ETIME\",\n                \"values\":[ {\n                    \"d\": chartDate, \"u\": chartDate\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"gt\",\n                \"preOrPost\":\"post\"\n            }\n            ],\n            \"properties\":[ {\n                \"id\": \"gridLines.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"itemAxis.labels.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"lines.smooth\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"markers.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"titles.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"valueAxis.zeroOrigin\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"valueAxis.labels.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"itemAxis.labels.layoutMode\", \"value\": \"rotate45\"\n            }\n            ,\n            {\n                \"id\":\"axisLabelColor\",\n                \"value\": {\n                    \"a\": 0.5, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\": \"maintainAxisScales\", \"value\": false\n            }\n            ,\n            {\n                \"id\":\"axisTitleFontColor\",\n                \"value\": {\n                    \"a\": 0.6, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"legendTitleColor\",\n                \"value\": {\n                    \"a\": 0.5, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"legendBodyColor\",\n                \"value\": {\n                    \"a\": 0.5, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"axisLineColor\",\n                \"value\": {\n                    \"a\": 0.25, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"axisGridLineColor\",\n                \"value\": {\n                    \"a\": 0.05, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"elementsLabelColor\",\n                \"value\": {\n                    \"a\": 0.6, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": true, \"unit\": \"seconds\", \"value\": 2, \"lastRefreshed\": 1528919583052\n            }\n            ,\n            \"fillColor\":\"transparent\",\n            \"showTitle\":true\n        }\n        ,\n        \"model00000163faa38c50_00000000\": {\n            \"id\":\"model00000163faa38c50_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model00000163fa696206_00000001\",\n                    \"dataItems\":[ {\n                        \"id\": \"model00000163faa3afbe_00000000\", \"itemId\": \"CALL_CLASSIFICATION.CONFIDENCE\", \"itemLabel\": \"CONFIDENCE\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model00000163faa3b63e_00000000\", \"itemId\": \"CALL_CLASSIFICATION.CLASS_NAME\", \"itemLabel\": \"CLASS_NAME\"\n                    }\n                    ],\n                    \"id\":\"model00000163faa3afbc_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\": \"categories\", \"dataItems\": [\"model00000163faa3b63e_00000000\"], \"dataItemSettings\": [], \"caption\": \"Words\", \"id\": \"categories\", \"layerId\": \"data\"\n                }\n                ,\n                {\n                    \"name\": \"size\", \"dataItems\": [\"model00000163faa3afbe_00000000\"], \"caption\": \"Size\", \"id\": \"size\", \"layerId\": \"data\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"com.ibm.vis.rave2bundlewordcloud\",\n            \"name\":\"Call Classification\",\n            \"fillColor\":\"transparent\",\n            \"localFilters\":[ {\n                \"id\":\"CALL_CLASSIFICATION.USER_\",\n                \"columnId\":\"CALL_CLASSIFICATION.USER_\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"CALL_CLASSIFICATION.USER_->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ],\n            \"showTitle\":true,\n            \"properties\":[ {\n                \"id\": \"word.orientation\", \"value\": \"horizontal\"\n            }\n            ,\n            {\n                \"id\": \"widget.legend.position\", \"value\": \"bottom\"\n            }\n            ,\n            {\n                \"id\": \"widget.legend.display\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"dial.roundedEnds\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"contrast.label.color\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"label.shadow\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"labels.visible\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"donutRadius\", \"value\": 1\n            }\n            ,\n            {\n                \"id\": \"label.percentage\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"labelLocation\", \"value\": \"none\"\n            }\n            ,\n            {\n                \"id\":\"axisTitleFontColor\",\n                \"value\": {\n                    \"a\": 0.6, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"legendTitleColor\",\n                \"value\": {\n                    \"a\": 0.5, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"legendBodyColor\",\n                \"value\": {\n                    \"a\": 0.5, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"axisLabelColor\",\n                \"value\": {\n                    \"a\": 0.5, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"axisLineColor\",\n                \"value\": {\n                    \"a\": 0.25, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"axisGridLineColor\",\n                \"value\": {\n                    \"a\": 0.05, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ,\n            {\n                \"id\":\"elementsLabelColor\",\n                \"value\": {\n                    \"a\": 0.6, \"r\": 0, \"g\": 0, \"b\": 0\n                }\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": true, \"unit\": \"seconds\", \"value\": 2, \"lastRefreshed\": 1528919583964\n            }\n        }\n        ,\n        \"model00000163faae1960_00000000\": {\n            \"id\":\"model00000163faae1960_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model00000163fa699ad8_00000001\",\n                    \"dataItems\":[ {\n                        \"id\": \"model00000163faae52f6_00000000\", \"itemId\": \"CALL_TONE.TONE_NAME\", \"itemLabel\": \"\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model00000163faae5f38_00000000\", \"itemId\": \"CALL_TONE.SCORE\", \"itemLabel\": \"SCORE\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model00000163faae7460_00000000\", \"itemId\": \"CALL_TONE.USER_\", \"itemLabel\": \"USER\"\n                    }\n                    ],\n                    \"id\":\"model00000163faae52f4_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\": \"categories\", \"dataItems\": [\"model00000163faae7460_00000000\"], \"dataItemSettings\": [], \"caption\": \"Bars\", \"id\": \"categories\"\n                }\n                ,\n                {\n                    \"name\": \"values\", \"dataItems\": [\"model00000163faae5f38_00000000\"], \"caption\": \"Length\", \"id\": \"values\"\n                }\n                ,\n                {\n                    \"name\": \"color\", \"dataItems\": [\"model00000163faae52f6_00000000\"], \"caption\": \"Color\", \"id\": \"color\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"com.ibm.vis.rave2bundlestackedbar\",\n            \"name\":\"Tone\",\n            \"localFilters\":[ {\n                \"id\":\"CALL_TONE.USER_\",\n                \"columnId\":\"CALL_TONE.USER_\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"CALL_TONE.USER_->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ],\n            \"showTitle\":true,\n            \"properties\":[ {\n                \"id\": \"stacked.percent\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"itemAxis.labels.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"valueAxis.labels.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"gridLines.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"titles.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"valueLabels.visible\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"maintainAxisScales\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"widget.legend.position\", \"value\": \"top\"\n            }\n            ,\n            {\n                \"id\": \"widget.legend.display\", \"value\": true\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": true, \"unit\": \"seconds\", \"value\": 2, \"lastRefreshed\": 1528919405202\n            }\n        },\n        \"model00000164008cb5ce_00000000\": {\n            \"id\":\"model00000164008cb5ce_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model0000016400833ab8_00000000\",\n                    \"dataItems\":[ {\n                        \"id\": \"model00000164008d766c_00000000\", \"itemId\": \"USERS.COUNTRY\", \"itemLabel\": \"COUNTRY\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model00000164008ee86a_00000000\", \"itemId\": \"USERS.STATE_\", \"itemLabel\": \"STATE\"\n                    }\n                    ],\n                    \"id\":\"model00000164008ccfda_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\": \"locations\", \"dataItems\": [\"model00000164008d766c_00000000\", \"model00000164008ee86a_00000000\"], \"dataItemSettings\": [], \"caption\": \"Locations\", \"id\": \"locations\", \"layerId\": \"data.region\"\n                }\n                ],\n                \"layers\":[ {\n                    \"type\": \"data.region\", \"id\": \"data.region\", \"dataViewId\": \"model00000164008ccfda_00000000\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"com.ibm.vis.rave2bundletiledmap\",\n            \"name\":\"Location\",\n            \"localFilters\":[ {\n                \"id\":\"USERS.PHONE\",\n                \"columnId\":\"USERS.PHONE\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"USERS.PHONE->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ],\n            \"showTitle\":true,\n            \"properties\":[ {\n                \"id\": \"mapStyle\", \"value\": \"bright\"\n            }\n            ,\n            {\n                \"id\": \"autoZoom\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"maintainAxisScales\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"Mapbox.secretToken\", \"value\": \"sk.eyJ1IjoiaWJtcmF2ZSIsImEiOiJjaXlrdjl6dzUwMDJlMnlwaXV3bTJtdGQ4In0.Ek4ZA_uWjmdwh9AzD-UWyg\"\n            }\n            ,\n            {\n                \"id\": \"Mapbox.accountName\", \"value\": \"ibmrave\"\n            }\n            ,\n            {\n                \"id\": \"Mapbox.token\", \"value\": \"pk.eyJ1IjoiaWJtcmF2ZSIsImEiOiJjaXRvZHFzdmYwM20zMnpzYmFxeHR4bTQyIn0.7rttWKsr9b1tVXpo0ZcWFw\"\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": false, \"unit\": \"seconds\", \"value\": 5, \"lastRefreshed\": 1529019417334\n            }\n        }\n        ,\n        \"model000001640098ef5a_00000000\": {\n            \"id\":\"model000001640098ef5a_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model0000016400368196_00000001\",\n                    \"dataItems\":[ {\n                        \"id\": \"model000001640099193c_00000001\", \"itemId\": \"CALL_UPSELL.PRODUCT\", \"itemLabel\": \"PRODUCT\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016400991f5a_00000001\", \"itemId\": \"CALL_UPSELL.PROBABILITY\", \"itemLabel\": \"PROBABILITY\"\n                    }\n                    ],\n                    \"id\":\"model000001640099193c_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\": \"categories\", \"dataItems\": [\"model000001640099193c_00000001\"], \"dataItemSettings\": [], \"caption\": \"Bubbles\", \"id\": \"categories\"\n                }\n                ,\n                {\n                    \"name\": \"size\", \"dataItems\": [\"model0000016400991f5a_00000001\"], \"caption\": \"Size\", \"id\": \"size\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"com.ibm.vis.rave2bundlepackedbubble\",\n            \"name\":\"Upsell\",\n            \"localFilters\":[ {\n                \"id\":\"CALL_UPSELL.USER_\",\n                \"columnId\":\"CALL_UPSELL.USER_\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"CALL_UPSELL.USER_->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ],\n            \"showTitle\":true,\n            \"properties\":[ {\n                \"id\": \"labels.visible\", \"value\": true\n            }\n            ,\n            {\n                \"id\": \"labels.format\", \"value\": \"Item\"\n            }\n            ,\n            {\n                \"id\": \"widget.legend.display\", \"value\": false\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": true, \"unit\": \"seconds\", \"value\": 5, \"lastRefreshed\": 1529019906012\n            }\n        }\n        ,\n        \"model00000164009d22c0_00000000\": {\n            \"id\":\"model00000164009d22c0_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model00000164009cf3ae_00000002\",\n                    \"dataItems\":[ {\n                        \"id\": \"model00000164009d7de4_00000000\", \"itemId\": \"CALL_RISK.RISK\", \"itemLabel\": \"RISK\"\n                    }\n                    ],\n                    \"id\":\"model00000164009d7de2_00000001\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\":\"values\",\n                    \"dataItems\":[\"model00000164009d7de4_00000000\"],\n                    \"dataItemSettings\":[ {\n                        \"graphic\": {\n                            \"content\": \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" version=\\\"1.1\\\"  class=\\\"staticContent\\\" height=\\\"100%\\\" width=\\\"100%\\\" preserveAspectRatio=\\\"none\\\"  viewBox=\\\"0 0 32 32\\\"><g xmlns=\\\"http://www.w3.org/2000/svg\\\" vector-effect=\\\"non-scaling-stroke\\\"><path d=\\\"M28.4,13.7c0-6.8-5.6-12.4-12.4-12.4S3.6,6.8,3.6,13.7c0,3.8,1.7,7.1,4.3,9.4l0,0.2V29c0,0,3.7,2,8.1,2 s8.1-2,8.1-2v-5.6l0-0.2C26.7,20.8,28.4,17.5,28.4,13.7z M23.2,22.6v0.2V28c0,0-0.8,0.5-2.1,1l0-2.9h-1.6l0,3.3 c-0.8,0.2-1.7,0.4-2.7,0.4l0-3.8h-1.6l0,3.8c-1-0.1-1.9-0.2-2.7-0.4l0-3.3h-1.6l0,2.8c-1.2-0.5-2-0.9-2-0.9v-5.2v-0.2 c-2.4-2.1-4.4-5.2-4.4-8.7C4.5,7.5,9.6,2.4,16,2.4s11.5,5.1,11.5,11.5C27.5,17.4,25.6,20.5,23.2,22.6z\\\" vector-effect=\\\"non-scaling-stroke\\\"/><path d=\\\"M16.1,17.7c-0.9,0-3,3.9-2.3,4.7c0.7,0.8,1.8-0.3,2.3-0.3c0.5,0,1.4,1,2.2,0.3C18.9,21.7,17,17.7,16.1,17.7 z\\\" vector-effect=\\\"non-scaling-stroke\\\"/><circle cx=\\\"11.6\\\" cy=\\\"13.5\\\" r=\\\"3\\\" vector-effect=\\\"non-scaling-stroke\\\"/><circle cx=\\\"20.4\\\" cy=\\\"13.5\\\" r=\\\"3\\\" vector-effect=\\\"non-scaling-stroke\\\"/></g></svg>\", \"fillColor\": \"color8\", \"borderColor\": \"transparent\", \"currentScaleOption\": 1\n                        }\n                        ,\n                        \"shapeDropEnabled\":true\n                    }\n                    ],\n                    \"caption\":\"Value\",\n                    \"id\":\"values\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"summary\",\n            \"name\":\"Risk\",\n            \"localFilters\":[ {\n                \"id\":\"CALL_RISK.USER_\",\n                \"columnId\":\"CALL_RISK.USER_\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"CALL_RISK.USER_->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ],\n            \"showTitle\":true,\n            \"properties\":[ {\n                \"id\": \"showItemLabel\", \"value\": false\n            }\n            ,\n            {\n                \"id\": \"fillDirection\", \"value\": \"BottomToTop\"\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": true, \"unit\": \"seconds\", \"value\": 5, \"lastRefreshed\": 1529019905002\n            }\n        }\n        ,\n        \"model00000164009fd2d2_00000000\": {\n            \"id\":\"model00000164009fd2d2_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model0000016400833ab8_00000000\",\n                    \"dataItems\":[ {\n                        \"id\": \"model0000016400adc6dc_00000000\", \"itemId\": \"Calculation_name_2\", \"itemLabel\": \"uvalue\"\n                    }\n                    ],\n                    \"id\":\"model00000164009ffcc0_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\":\"values\",\n                    \"dataItems\":[\"model0000016400adc6dc_00000000\"],\n                    \"dataItemSettings\":[ {\n                        \"graphic\": {\n                            \"content\": \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" version=\\\"1.1\\\"  class=\\\"staticContent\\\" height=\\\"100%\\\" width=\\\"100%\\\" preserveAspectRatio=\\\"none\\\"  viewBox=\\\"0 0 32 32\\\"><g xmlns=\\\"http://www.w3.org/2000/svg\\\" vector-effect=\\\"non-scaling-stroke\\\"><path d=\\\"M0,7.8v18.4h32V7.8H0z M30,24.3H2V9.7h28V24.3z\\\" vector-effect=\\\"non-scaling-stroke\\\"/><path d=\\\"M3,10.7v12.6h26V10.7H3z M18.1,20c-0.4,0.5-1.3,0.7-2.1,0.8v1.1h-1v-1.1c-1.4-0.1-2.3-0.8-2.6-2l1.6-0.4 c0.2,0.7,0.7,1,1.5,1c0.4,0,0.7-0.1,0.9-0.2c0.2-0.1,0.3-0.3,0.3-0.6c0-0.2-0.1-0.4-0.3-0.5c-0.2-0.1-0.5-0.2-1-0.3 c-1.1-0.2-1.8-0.5-2.1-0.9c-0.3-0.4-0.5-0.8-0.5-1.4s0.2-1.1,0.6-1.6c0.4-0.4,0.9-0.7,1.6-0.8v-0.9h1v0.9c1.2,0.1,2,0.7,2.4,1.7 l-1.5,0.5c-0.2-0.6-0.6-0.9-1.3-0.9c-0.7,0-1,0.2-1,0.7c0,0.2,0.1,0.3,0.2,0.5c0.1,0.2,0.4,0.2,0.9,0.3c0.8,0.2,1.3,0.3,1.7,0.5 c0.4,0.2,0.7,0.4,0.9,0.8c0.2,0.4,0.4,0.7,0.4,1.2C18.7,19,18.5,19.5,18.1,20z\\\" vector-effect=\\\"non-scaling-stroke\\\"/></g></svg>\", \"fillColor\": \"color8\", \"borderColor\": \"transparent\", \"currentScaleOption\": 1\n                        }\n                        ,\n                        \"shapeDropEnabled\":true\n                    }\n                    ],\n                    \"caption\":\"Value\",\n                    \"id\":\"values\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"summary\",\n            \"name\":\"Value\",\n            \"localFilters\":[],\n            \"showTitle\":true,\n            \"properties\":[ {\n                \"id\": \"showItemLabel\", \"value\": false\n            }\n            ]\n        },\n        \"model0000016401b3c240_00000000\": {\n            \"id\":\"model0000016401b3c240_00000000\",\n            \"data\": {\n                \"dataViews\":[ {\n                    \"modelRef\":\"model0000016400833ab8_00000000\",\n                    \"dataItems\":[ {\n                        \"id\": \"model0000016401b433ca_00000001\", \"itemId\": \"USERS.FNAME\", \"itemLabel\": \"First\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016401b44060_00000000\", \"itemId\": \"USERS.LNAME\", \"itemLabel\": \"Last\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016401c1ab34_00000000\", \"itemId\": \"USERS.ADDRESS\", \"itemLabel\": \"Address\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016401c1f772_00000000\", \"itemId\": \"USERS.CITY\", \"itemLabel\": \"City\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016401c2b046_00000000\", \"itemId\": \"USERS.MONTHLY_PAYMENT\", \"itemLabel\": \"Payment\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016401c31d82_00000000\", \"itemId\": \"USERS.AGE\", \"itemLabel\": \"Age\"\n                    }\n                    ,\n                    {\n                        \"id\": \"model0000016401c33a5e_00000000\", \"itemId\": \"USERS.GENDER\", \"itemLabel\": \"Sex\"\n                    }\n                    ],\n                    \"id\":\"model0000016401b433ca_00000000\"\n                }\n                ]\n            }\n            ,\n            \"visTypeLocked\":true,\n            \"slotmapping\": {\n                \"slots\":[ {\n                    \"name\": \"grid_cols\", \"dataItems\": [\"model0000016401b433ca_00000001\", \"model0000016401b44060_00000000\", \"model0000016401c31d82_00000000\", \"model0000016401c33a5e_00000000\", \"model0000016401c1ab34_00000000\", \"model0000016401c1f772_00000000\", \"model0000016401c29cbc_00000000\", \"model0000016401c2b046_00000000\"], \"caption\": \"Columns\", \"id\": \"grid_cols\"\n                }\n                ]\n            }\n            ,\n            \"type\":\"live\",\n            \"visId\":\"JQGrid\",\n            \"name\":\"\",\n            \"localFilters\":[ {\n                \"id\":\"USERS.PHONE\",\n                \"columnId\":\"USERS.PHONE\",\n                \"values\":[ {\n                    \"d\": yourPhone, \"u\": \"USERS.PHONE->[\" + yourPhone + \"]\"\n                }\n                ],\n                \"excludedValues\":[],\n                \"operator\":\"in\",\n                \"type\":null\n            }\n            ],\n            \"properties\":[ {\n                \"id\": \"hideSummaries\", \"value\": true\n            }\n            ],\n            \"queryRefresh\": {\n                \"autoRefresh\": false, \"unit\": \"seconds\", \"value\": 5\n            }\n        }\n    }\n};\n        \n","x":740,"y":400,"wires":[]},{"id":"6143e68d.f84668","type":"function","z":"8246e271.253b4","name":"","func":"msg.hideChat = \"block\";\n\nif(typeof(msg.payload.ua) != \"undefined\"){\n    if(msg.payload.ua == \"iphone\")\n        msg.hideChat = \"none\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":120,"wires":[["70e4e4b5.46beb4"]]},{"id":"b6ed2cdd.6c7dc8","type":"http in","z":"45bfaeea.5a7458","name":"","url":"/chat","method":"post","upload":false,"swaggerDoc":"","x":110,"y":260,"wires":[["9f0e59b6.581368"]]},{"id":"9f0e59b6.581368","type":"function","z":"45bfaeea.5a7458","name":"","func":"msg.text = msg.payload.text;\nmsg.user = msg.payload.user;\nmsg.industry = msg.payload.industry;\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":260,"wires":[["78222dec.7fe19c","777cfd89.fc7f34"]]},{"id":"777cfd89.fc7f34","type":"http response","z":"45bfaeea.5a7458","name":"","statusCode":"","headers":{},"x":390,"y":260,"wires":[]},{"id":"62e7ee88.eab248","type":"function","z":"45bfaeea.5a7458","name":"#goodbye","func":"//Clears payload (like whole new coversation)\nif (msg.payload.intents[0].intent !== 'undefined'){\n    if (msg.payload.intents[0].intent == 'goodbye') {\n        ucontext[msg.user] = {};\n        node.warn('terminated session with goodbye intent');\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":480,"wires":[[]]},{"id":"1ba6aa7f.0c67c6","type":"watson-conversation-v1","z":"45bfaeea.5a7458","name":"WA","workspaceid":"","multiuser":true,"context":false,"empty-payload":true,"default-endpoint":true,"service-endpoint":"https://gateway.watsonplatform.net/assistant/api","timeout":"","optout-learning":false,"x":310,"y":420,"wires":[["da5db8d.3e3e648"]]},{"id":"da5db8d.3e3e648","type":"function","z":"45bfaeea.5a7458","name":"handle actions","func":"if(typeof msg.payload.actions !== \"undefined\"){\n    //save parameters\n    msg.actionparameters = msg.payload.actions[0].parameters;\n    //save context\n    msg.actioncontext = msg.payload.context;\n    //set the discovery query from the action parameters   \n    msg.discoveryparams = {query: msg.actionparameters.intent};\n    // node.warn('I haz action payload');\n    return [msg,null]\n} else {\n    var discoveryinfo = msg.search_results;\n    //Restoring old payload\n    if(typeof msg.payload_old !== \"undefined\") {\n        //restoring old payload that was mutated by second pasage through WA\n        msg.payload = msg.payload_old;\n    }\n    //appending link to payload if there\n    if(typeof msg.link  !== \"undefined\"){\n        \n        msg.payload.output.link = 'Check out: ' + msg.link;\n    }\n\n    return [null,msg]\n}\n","outputs":2,"noerr":0,"x":480,"y":420,"wires":[["e15d33e3.1e218"],["e40975d4.21f128","522f4973.37853","62e7ee88.eab248"]]},{"id":"e15d33e3.1e218","type":"watson-discovery-v1","z":"45bfaeea.5a7458","name":"Discovery","environmentname":"","environment_id":"142065f5-715e-4a7a-abbe-59ef0252d4a2","collection_id":"b67e8cc8-cea0-419e-8eef-32cba7415fd5","configurationname":"","configuration_id":"","language_code":"en","collection_name":"","count":"1","passages":true,"nlp_query":true,"query":"","filter":"","aggregation":"","return":"","description":"","size":0,"discovery-method":"query","default-endpoint":true,"service-endpoint":"https://gateway.watsonplatform.net/discovery/api","x":320,"y":460,"wires":[["1b4134ea.6e5ecb"]]},{"id":"1b4134ea.6e5ecb","type":"function","z":"45bfaeea.5a7458","name":"process results","func":"var discoveryinfo = msg.search_results;\nvar ucontext = flow.get('ucontext');\nvar workspaces = flow.get('assistants');\n\n\nif (typeof msg.actionparameters.urlonly !== \"undefined\"){\n    //check to see if the doc type is word\n    if(discoveryinfo.results[0].extracted_metadata.file_type === 'word'){\n        //handle word docs\n        var link = \"https://discovery-docs.mybluemix.net/docs/\" + discoveryinfo.results[0].extracted_metadata.filename.split(\".\")[0] + \".pdf\";\n        link = \"<a href='\" + link + \"' target='_blank'>\" + discoveryinfo.results[0].extracted_metadata.filename.split(\".\")[0] + \"</a>\";\n        // node.warn('PDR: got word doc');\n    } else {\n        //handle html files\n        var link = discoveryinfo.results[0].extracted_metadata.filename.replace(/:/g,'/').replace('-',':').replace(/(.htm|.html)/,'');\n        link = \"<a href='\" + link + \"' target='_blank'>\" + discoveryinfo.results[0].extracted_metadata.title + \"</a>\"\n        // node.warn('PDR: got else doc');\n    }\n    \n    discoveryinfo = link;        \n    //add link to the msg object\n    msg.link = link;\n    // node.warn('process results link: ' + link);\n    \n}\n\n\n//set the context and add the discovery response\nmsg.params = {context: Object.assign(msg.actioncontext,{discovery: discoveryinfo})}\nmsg.params.workspace_id = workspaces[ucontext[msg.user].industry]\n\n//backing up the old payload\n// msg.payload_old = msg.payload;\n\n//return the same text to WA\nmsg.payload = msg.actionparameters.text;\nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"x":480,"y":460,"wires":[["1ba6aa7f.0c67c6"]]},{"id":"e40975d4.21f128","type":"switch","z":"45bfaeea.5a7458","name":"Routing","property":"origin","propertyType":"msg","rules":[{"t":"neq","v":"sip","vt":"str"},{"t":"eq","v":"sip","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":380,"wires":[["c402f685.779ff8"],["2c99eb32.b9eabc"]]},{"id":"6cd183bc.23399c","type":"http response","z":"45bfaeea.5a7458","name":"","statusCode":"","headers":{},"x":590,"y":100,"wires":[]},{"id":"9ff535fe.304508","type":"http response","z":"45bfaeea.5a7458","name":"","statusCode":"","headers":{},"x":590,"y":180,"wires":[]}]
